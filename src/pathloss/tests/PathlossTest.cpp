/*******************************************************************************
 * This file is part of IMTAphy
 * _____________________________________________________________________________
 *
 * Copyright (C) 2010
 * Institute of Communication Networks (LKN)
 * Department of Electrical Engineering and Information Technology (EE & IT)
 * Technische Universitaet Muenchen
 * Arcisstr. 21
 * 80333 Muenchen - Germany
 * http://www.lkn.ei.tum.de/~jan/imtaphy/index.html
 * 
 * _____________________________________________________________________________
 *
 *   IMTAphy is free software: you can redistribute it and/or modify
 *   it under the terms of the GNU General Public License as published by
 *   the Free Software Foundation, either version 3 of the License, or
 *   (at your option) any later version.
 *
 *   IMTAphy is distributed in the hope that it will be useful,
 *   but WITHOUT ANY WARRANTY; without even the implied warranty of
 *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *   GNU General Public License for more details.
 *
 *   You should have received a copy of the GNU General Public License
 *   along with IMTAphy.  If not, see <http://www.gnu.org/licenses/>.
 *
 ******************************************************************************/

#include <WNS/CppUnit.hpp>
#include <cppunit/extensions/HelperMacros.h>
#include <IMTAPHY/pathloss/M2135Pathloss.hpp>
#include <IMTAPHY/pathloss/No.hpp>
#include <IMTAPHY/tests/ChannelStub.hpp>
#include <IMTAPHY/tests/StationPhyStub.hpp>
#include <IMTAPHY/linkManagement/LinkManager.hpp>
#include <IMTAPHY/tests/StationPhyStub.hpp>

#include <WNS/pyconfig/View.hpp>
#include <WNS/pyconfig/Parser.hpp>


namespace imtaphy { namespace pathloss { namespace tests {
            class PathlossTest :
            public CppUnit::TestFixture
            {
                CPPUNIT_TEST_SUITE( PathlossTest );
                CPPUNIT_TEST( testPathlossValue );
                CPPUNIT_TEST( testo2vDistribution );
                CPPUNIT_TEST( testo2vUEPositionDependence );
                CPPUNIT_TEST( testO2IforSMa );
                CPPUNIT_TEST( testO2IUMiDistanceDependence );
                CPPUNIT_TEST_SUITE_END();

            public:
                void setUp();
                void tearDown();
                
                void testPathlossValue();

                void testo2vDistribution();
                void testo2vUEPositionDependence();
                void testO2IforSMa();
                void testO2IUMiDistanceDependence();
            private:
                imtaphy::pathloss::M2135Pathloss* pathlossM2135;
                imtaphy::tests::ChannelStub* channel;
                wns::Position msPos;
                double freqMHz;
            };
        
            CPPUNIT_TEST_SUITE_REGISTRATION( PathlossTest );
        
            void
            PathlossTest::setUp()
            {
                channel = new imtaphy::tests::ChannelStub();
                std::stringstream ss_linkManager;
                ss_linkManager <<"import imtaphy.LinkManagement\n"
                            << "import imtaphy.Logger\n"
                            << "linkManager = imtaphy.LinkManagement.LinkManager(classifier = imtaphy.LinkManagement.ITUClassifier(\"UMi\"),\n"
                            << "scmLinkCriterion = \"none\",\n"
                            << "handoverMargin = \"1 dB\",\n"
                            << "shiftVectors = [])";
                
                wns::pyconfig::Parser all_linkManager;
                all_linkManager.loadString(ss_linkManager.str());
                wns::pyconfig::View configLinkManager(all_linkManager, "linkManager");
                imtaphy::LinkManager* linkManager = new imtaphy::LinkManager(channel, imtaphy::StationList(), imtaphy::StationList(),  configLinkManager); // cannot use linkManagerStub here because the M2135Pathloss needs CONFIG
                channel->setLinkManager(linkManager);

        
                std::stringstream ss_pathloss;
                ss_pathloss <<"import imtaphy.Pathloss\n"
                            << "import imtaphy.Logger\n"
                            << "pathloss = imtaphy.Pathloss.M2135Pathloss()\n";
                wns::pyconfig::Parser all_pathloss;
                all_pathloss.loadString(ss_pathloss.str());
                wns::pyconfig::View config(all_pathloss, "pathloss");
                pathlossM2135 = new imtaphy::pathloss::M2135Pathloss(channel, config);
                

                pathlossM2135->onWorldCreated();        
        
            }

            void 
            PathlossTest::tearDown()
            {
            }

            void 
            PathlossTest::testPathlossValue()
            {
                // hBS = 25m and hUT = 1.5m  => dBP is 320m
                msPos.set(150,125,1.5); // height of UT = 1.5m
    
                double lambda = 0.15;
    
                wns::node::Registry* registry = new wns::node::Registry();
    
                imtaphy::tests::StationPhyStub* bs = createStationStub("BS1", wns::Position(100, 100, 6), "BS", 1, 10.0 * lambda, 0, registry, channel);
                imtaphy::tests::StationPhyStub* ms = createStationStub("MS1", wns::Position(150, 125, 1.5), "MS", 1, 0.5 * lambda, 0, registry, channel);

                imtaphy::LinkStub linkInHNLoS(bs, ms, imtaphy::Link::InH, imtaphy::Link::NLoS, imtaphy::Link::NLoS, imtaphy::Link::NotApplicable, msPos, wns::Ratio::from_dB(0.0), 1);
    
                freqMHz = 2000.0; // frequency for baseline evaluation = 2 GHz
                wns::Ratio pathloss_value;
                pathloss_value = pathlossM2135->getInHPathloss(&linkInHNLoS, freqMHz);
                //std::cout << "\nPathloss Value InH NLoS is: " << pathloss_value << std::endl;
                CPPUNIT_ASSERT_DOUBLES_EQUAL(93.1841, pathloss_value.get_dB(), 0.001);

                imtaphy::LinkStub linkInHLoS(bs, ms, imtaphy::Link::InH, imtaphy::Link::LoS, imtaphy::Link::LoS, imtaphy::Link::NotApplicable, msPos, wns::Ratio::from_dB(0.0), 1);
                pathloss_value = pathlossM2135->getInHPathloss(&linkInHLoS, freqMHz);
                //std::cout << "Pathloss Value InH LoS is: " << pathloss_value << std::endl;
                CPPUNIT_ASSERT_DOUBLES_EQUAL(68.3521, pathloss_value.get_dB(), 0.001);
        
                imtaphy::tests::StationPhyStub* bs2 = createStationStub("BS2", wns::Position(100, 100, 10), "BS", 1, 10.0 * lambda, 0, registry, channel);
                imtaphy::LinkStub linkUMiNLoS(bs2, ms, imtaphy::Link::InH, imtaphy::Link::NLoS, imtaphy::Link::NLoS, imtaphy::Link::Outdoor, msPos, wns::Ratio::from_dB(0.0), 1);
                pathloss_value = pathlossM2135->getUMiPathloss(&linkUMiNLoS, freqMHz);
                //std::cout << "Pathloss Value UMi NLoS is: " << pathloss_value << std::endl;
                CPPUNIT_ASSERT_DOUBLES_EQUAL(94.6573, pathloss_value.get_dB(), 0.001);

                imtaphy::LinkStub linkUMiLoS(bs2, ms, imtaphy::Link::InH, imtaphy::Link::LoS, imtaphy::Link::LoS, imtaphy::Link::Outdoor, msPos, wns::Ratio::from_dB(0.0), 1);
                pathloss_value = pathlossM2135->getUMiPathloss(&linkUMiLoS, freqMHz);
                //std::cout << "Pathloss Value UMi LoS is: " << pathloss_value << std::endl;
                CPPUNIT_ASSERT_DOUBLES_EQUAL(72.4640, pathloss_value.get_dB(), 0.001);

                imtaphy::tests::StationPhyStub* bs3 = createStationStub("BS3", wns::Position(100, 100, 35), "BS", 1, 10.0 * lambda, 0, registry, channel);
                imtaphy::LinkStub linkSMaNLoS(bs3, ms, imtaphy::Link::SMa, imtaphy::Link::NLoS, imtaphy::Link::NLoS, imtaphy::Link::Outdoor, msPos, wns::Ratio::from_dB(0.0), 1);
                pathloss_value = pathlossM2135->getSMaPathloss(&linkSMaNLoS, freqMHz);
                //std::cout << "Pathloss Value SMa NLoS is: " << pathloss_value << std::endl;
                CPPUNIT_ASSERT_DOUBLES_EQUAL(88.770422436592014, pathloss_value.get_dB()+9.0, 0.01);

                imtaphy::LinkStub linkSMaLoS(bs3, ms, imtaphy::Link::SMa, imtaphy::Link::LoS, imtaphy::Link::LoS, imtaphy::Link::Outdoor, msPos, wns::Ratio::from_dB(0.0), 1);
                pathloss_value = pathlossM2135->getSMaPathloss(&linkSMaLoS, freqMHz);
                //std::cout << "Pathloss Value SMa LoS is: " << pathloss_value << std::endl;
                CPPUNIT_ASSERT_DOUBLES_EQUAL(82.964707935652910, pathloss_value.get_dB()+9.0, 0.01);

                CPPUNIT_ASSERT(pathloss_value.get_dB()<100.0 && pathloss_value.get_dB()>-100.0);        
                registry->clear();
        
            }



            void 
            PathlossTest::testo2vDistribution()
            {
                wns::node::Registry* registry = new wns::node::Registry();
                freqMHz = 2000.0;
                double lambda = 3e08/(freqMHz*1e6);
                imtaphy::tests::StationPhyStub* bs = createStationStub("BS1", wns::Position(100,100,25), "BS", 1, 10.0 * lambda, 0, registry, channel);
                wns::Ratio pathloss_value;
                wns::evaluation::statistics::Moments mnt;
                itpp::vec pathloss_vector_matlabUMa = "101.191131247498248 101.520753288820032 101.844096431699342 102.161395422210830 102.472872083134916 102.778736245497157 103.079186597657042 103.374411460551158 103.664589496666451 103.949890359426632 104.230475288903051 104.506497659086946 104.778103481374018 105.045431868399533 105.308615461912666 105.567780827984706 105.823048822498890 106.074534929563811 106.322349575222503 106.566598418589820 106.807382622339901 107.044799104276393 107.278940771551333 107.509896738949095 107.737752532519266 107.962590279722605 108.184488887147893 108.403524206762455 108.619769191572402 108.833294041492195 109.044166340153254 109.252451183318783 109.458211299515170 109.661507163439595 109.862397102656473 110.060937398054023 110.257182378493596 110.451184510050268 110.642994480211044 110.832661277369056 111.020232265925642 111.205753257288080 111.389268577029384 111.570821128456572 111.750452452815253 111.928202786341984 112.104111114360336 112.278215222602796 112.450551745927129 112.621156214584857 112.790063098187318 112.957305847506262 113.122916934234837 113.286927888828032 113.449369336532271 113.610271031707356 113.769661890537208 113.927570022218845 114.084022758714127 114.239046683142931 114.392667656891533 114.544910845505171 114.695800743430055 114.845361197665042 114.993615430380743 115.140586060559187 115.286295124704907 115.430764096674466 115.574013906669450 115.716064959434632 115.856937151701004 115.996649888911065 116.135222101261235 116.272672259094946 116.409018387677492 116.544278081382032 116.678468517315082 116.811606468407547 116.943708315996446 117.074790061920709 117.204867340153527 117.333955427992720 117.462069256828244 117.589223422506876 117.715432195311507 117.840709529571825 117.965069072923569 118.088524175230532 118.211087897184598 118.332773018597834 118.453592046398995 118.573557222347887 118.692680530478768 118.810973704284422 118.928448233651835 119.045115371559348 119.160986140545219 119.276071338957109 119.390381546990781 119.503927132527281 119.616718256775826 119.728764879730619 119.840076765448700 119.950663487155907 120.060534432187609 120.169698806770469 120.278165640651551 120.385943791580416 120.493041949649779 120.599468641500209 120.705232234393691 120.810340940161268 120.914802819028921 121.018625783326797 121.121817601085382 121.224385899523185 121.326338168429800 121.427681763447609 121.528423909256531 121.628571702664487 121.728132115607480 121.827111998062037 121.925518080873289 122.023356978501610 122.120635191690482 122.217359110058297 122.313535014616889 122.409169080219044 122.504267377937396 122.598835877377070 122.692880448924456 122.786406865933657 122.879420806853489 122.971927857296095 123.063933512049744 123.155443177037398 123.246462171222575 123.336995728464572 123.427048999324484 123.516627052823253 123.605734878154180 123.694377386349998 123.782559411907243 123.870285714368350 123.957560979863104 124.044389822610810 124.130776786383933 124.216726345935143 124.302242908387967 124.387330814592872 124.471994340449328 124.556237698195332 124.640065037664812 124.723480447514277 124.806487956419431 124.889091534242851 124.971295093172955 125.053102488836046 125.134517521381355 125.215543936540257 125.296185426660429 125.376445631715342 125.456328140290339 125.535836490545222 125.614974171154685 125.693744622226845 125.772151236200585 125.850197358722113 125.927886289501771 126.005221283150945 126.082205550000310 126.158842256899518 126.235134527998810 126.311085445513186 126.386698050469704 126.461975343438056 126.536920285244960 126.611535797673042 126.685824764144314 126.759790030388757 126.833434405098359 126.906760660567187 126.979771533317603 127.052469724712893 127.124857901557235 127.196938696682480 127.268714709522868 127.340188506677464 127.411362622460928 127.482239559442633 127.552821788974711 127.623111751709018 127.693111858103720 127.762824488919065 127.832251995703459 127.901396701269249 127.970260900159104 128.038846859102989 128.107156817465636 128.175192987685506 128.242957555704635 128.310452681390046 128.377680498946830 128.444643117323096 128.511342620606911 128.577781068415561 128.643960496277089 128.709882916004460 128.775550316062720 128.840964661928695 128.906127896444048 128.971041940161541 129.035708691684647 129.100130028000706 129.164307804808004 129.228243856836229 129.291939998161467 129.355398022514919 129.418619703585875 129.481606795319522 129.544361032208485 129.606884129579839 129.669177783876080 129.731243672931612 129.793083456243608 129.854698775238546 129.916091253533409 129.977262497192612 130.038214094979821 130.098947618605848 130.159464622971569 130.219766646407010 130.279855210905851 130.339731822355930 130.399397970765705 130.458855130486768 130.518104760432436 130.577148304292422 130.635987190744117 130.694622833659849 130.753056632310802 130.811289971567362 130.869324222096083 130.927160740553234 130.984800869775114 131.042245938965095 131.099497263877595 131.156556146998810 131.213423877724580 131.270101732535295 131.326590975167676 131.382892856783826 131.439008616137755 131.494939479738633 131.550686662011742 131.606251365456728 131.661634780803183 131.716838087163922 131.771862452185303 131.826709032195623 131.881378972350944 131.935873406778484 131.990193458717755 132.044340240659551 132.098314854482680 132.152118391588431 132.205751933032957 132.259216549657793 132.312513302217923 132.365643241508224 132.418607408487645 132.471406834401705 132.524042540902911 132.576515540169282 132.628826835021357 132.680977419036935 132.732968276664565 132.784800383334812 132.836474705570225 132.887992201093368 132.939353818933512 132.990560499531199 133.041613174841956 133.092512768437814 133.143260195607553 133.193856363455609 133.244302170999276 133.294598509264517 133.344746261380493 133.394746302672502 133.444599500753696 133.494306715615494 133.543868799716421 133.593286598070051 133.642560948331180 133.691692680881317 133.740682618912359 133.789531578509639 133.838240368733210 133.886809791698511 133.935240642655344 133.983533710066297 134.031689775683560 134.079709614624903 134.127593995448592 134.175343680227058 134.222959424619887 134.270441977945410 134.317792083251419 134.365010477385084 134.412097891061677 134.459055048932441 134.505882669651442 134.552581465941671 134.599152144659996 134.645595406861503 134.691911947862707 134.738102457304109 134.784167619211672 134.830108112057758 134.875924608820981 134.921617777045412 134.967188278898874 135.012636771230575 135.057963905627958 135.103170328472572 135.148256680995701 135.193223599332470 135.238071714576222 135.282801652831267 135.327414035265519 135.371909478162195 135.416288592970886 135.460551986358013 135.504700260256584 135.548734011915258 135.592653833946883 135.636460314376365 135.680154036687782 135.723735579871118 135.767205518468359 135.810564422618825 135.853812858103993 135.896951386391947 135.939980564681093 135.982900945943157 136.025713078966106 136.068417508395981 136.111014774778681 136.153505414600886 136.195889960330589 136.238168940457342 136.280342879531474 136.322412298203346 136.364377713261945 136.406239637672826 136.447998580615831 136.489655047522291 136.531209540111547 136.572662556427474 136.614014590874035 136.655266134250866 136.696417673788119 136.737469693180969 136.778422672623833 136.819277088844046 136.860033415135035 136.900692121389341 136.941253674131133 136.981718536548271 137.022087168523996 137.062360026668415 137.102537564349433 137.142620231723356 137.182608475765136 137.222502740298353 137.262303466024690 137.302011090553208 137.341626048429191 137.381148771162685 137.420579687256634 137.459919222234845 137.499167798669589 137.538325836208600 137.577393751602273 137.616371958730127 137.655260868627153 137.694060889509785 137.732772426801631 137.771395883158959 137.809931658495685 137.848380150008325 137.886741752200578 137.925016856907519 137.963205853319693 138.001309128006824 138.039327064941233 138.077260045521200 138.115108448593816 138.152872650477718 138.190553024985519 138.228149943446056 138.265663774726278 138.303094885252960 138.340443639034305 138.377710397681057 138.414895520427507 138.451999364152329 138.489022283399123 138.525964630396743 138.562826755079357 138.599609005106345 138.636311725882052 138.672935260575201 138.709479950138046 138.745946133325589 138.782334146714362 138.818644324720907 138.854876999620529 138.891032501565235 138.927111158602003 138.963113296690466 138.999039239720759 139.034889309530854 139.070663825923930 139.106363106685478 139.141987467600217 139.177537222468942 139.213012683124958 139.248414159450647 139.283741959393609 139.318996388982697 139.354177752344157 139.389286351717033 139.424322487468999 139.459286458111706 139.494178560316016 139.528999088927065 139.563748336979387 139.598426595711459 139.633034154580599 139.667571301277235 139.702038321739451 139.736435500167119 139.770763119035820 139.805021459110975 139.839210799461540 139.873331417473622 139.907383588864008 139.941367587693520 139.975283686380237 140.009132155712649 140.042913264862563 140.076627281398061 140.110274471295980 140.143855098954845 140.177369427206969 140.210817717331111 140.244200229064461 140.277517220614925 140.310768948672973 140.343955668423575 140.377077633557917 140.410135096285074 140.443128307343500 140.476057516012474 140.508922970123308 140.541724916070734 140.574463598823712 140.607139261936709 140.639752147560273 140.672302496452062 140.704790547987329 140.737216540169555 140.769580709640934 140.801883291692633 140.834124520275253 140.866304628008720 140.898423846192628 140.930482404816019 140.962480532567326 140.994418456844244 141.026296403763297 141.058114598169482 141.089873263645870 141.121572622522905 141.153212895887805 141.184794303593890 141.216317064269532 141.247781395327507 141.279187512973778 141.310535632216499 141.341825966874865 141.373058729587854 141.404234131822790 141.435352383884094 141.466413694921755 141.497418272939598 141.528366324803926 141.559258056251593 141.590093671898245 141.620873375246532 141.651597368694041 141.682265853541423 141.712879030000181 141.743437097200598 141.773940253199498 141.804388694987836 141.834782618498508 141.865122218613834 141.895407689172998 141.925639222979584 141.955817011808819 141.985941246415024 142.016012116538718 142.046029810913865 142.075994517274893 142.105906422363915 142.135765711937495 142.165572570773719 142.195327182678966 142.225029730494782 142.254680396104618 142.284279360440451 142.313826803489405 142.343322904300436 142.372767840990718 142.402161790752132 142.431504929857681 142.460797433667864 142.490039476636809 142.519231232318788 142.548372873374092 142.577464571575376 142.606506497813569 142.635498822104097 142.664441713592652 142.693335340561248 142.722179870434019 142.750975469783128 142.779722304334399 142.808420538973110 142.837070337749765 142.865671863885581 142.894225279778112 142.922730747006796 142.951188426338405 142.979598477732594 143.007961060347100 143.036276332543309 143.064544451891408 143.092765575175662 143.120939858399765 143.149067456791840 143.177148524809695 143.205183216145770 143.233171683732422 143.261114079746648 143.289010555615249 143.316861262019728 143.344666348901086 143.372425965464714 143.400140260185225 143.427809380811226 143.455433474369897 143.483012687171936 143.510547164815961 143.538037052193289 143.565482493492425 143.592883632203637 143.620240611123393 143.647553572358959 143.674822657332697 143.702048006786498 143.729229760786154 143.756368058725769 143.783463039331792 143.810514840667565 143.837523600137388 143.864489454490695 143.891412539826320 143.918292991596445 143.945130944610867 143.971926533040971 143.998679890423745 144.025391149665808 144.052060443047310 144.078687902225937 144.105273658240804 144.131817841516238 144.158320581865723 144.184782008495660 144.211202250009137 144.237581434409719 144.263919689105109 144.290217140910926 144.316473916054235 144.342690140177297 144.368865938341202 144.395001435029371 144.421096754151023 144.447152019044950 144.473167352482790 144.499142876672579 144.525078713262218 144.550974983342826 144.576831807452209 144.602649305578211 144.628427597161988 144.654166801101383 144.679867035754199 144.705528418941498 144.731151067950776 144.756735099539213 144.782280629936906 144.807787774849970 144.833256649463749 144.858687368445828 144.884080045949247 144.909434795615567 144.934751730577830 144.960030963463623 144.985272606398212 145.010476771007291 145.035643568420170 145.060773109272560 145.085865503709528 145.110920861388507 145.135939291482003 145.160920902680488 145.185865803195412 145.210774100761711 145.235645902640840 145.260481315623508 145.285280446032260 145.310043399724435 145.334770282094780 145.359461198078037 145.384116252151841 145.408735548339195 145.433319190211108 145.457867280889303 145.482379923048796 145.506857218920373 145.531299270293260 145.555706178517624 145.580078044507104 145.604414968741224 145.628717051268040 145.652984391706497 145.677217089248899 145.701415242663359 145.725578950296182 145.749708310074311 145.773803419507686 145.797864375691574 145.821891275308985 145.845884214632918 145.869843289528774 145.893768595456578 145.917660227473277 145.941518280235073 145.965342847999523 145.989134024627901 146.012891903587445 146.036616577953396 146.060308140411394 146.083966683259405 146.107592298410168 146.131185077393098 146.154745111356476 146.178272491069691 146.201767306925149 146.225229648940456 146.248659606760498 146.272057269659484 146.295422726542881 146.318756065949685 146.342057376054157 146.365326744668010 146.388564259242315 146.411770006869517 146.434944074285312 146.458086547870721 146.481197513653882 146.504277057312123 146.527325264173641 146.550342219219687 146.573328007086189 146.596282712065772 146.619206418109542 146.642099208828995 146.664961167497751 146.687792377053398 146.710592920099458 146.733362878906860 146.756102335416074 146.778811371238589 146.801490067658847 146.824138505635972 146.846756765805367 146.869344928480587 146.891903073655101 146.914431281003687 146.936929629884503 146.959398199340484 146.981837068101157 147.004246314584236 147.026626016897268 147.048976252839282 147.071297099902438 147.093588635273534 147.115850935835766 147.138084078170181 147.160288138557377 147.182463192978901 147.204609317118951 147.226726586365999 147.248815075814093 147.270874860264570 147.292906014227498 147.314908611923272 147.336882727283950 147.358828433954898 147.380745805296272 147.402634914384379 147.424495834013157 147.446328636695796 147.468133394665870 147.489910179879132 147.511659064014680 147.533380118476401 147.555073414394514 147.576739022626839 147.598377013760228 147.619987458111979 147.641570425731146 147.663125986399962 147.684654209635084 147.706155164689079 147.727628920551695 147.749075545951172 147.770495109355579 147.791887678974120 147.813253322758442 147.834592108403996 147.855904103351151 147.877189374786695 147.898447989644865 147.919680014608900 147.940885516111933 147.962064560338604 147.983217213226084 148.004343540465356 148.025443607502382 148.046517479539489 148.067565221536313 148.088586898211361 148.109582574042804 148.130552313269931 148.151496179894309 148.172414237680812 148.193306550158951 148.214173180623845 148.235014192137612 148.255829647530305 148.276619609401109 148.297384140119561 148.318123301826546 148.338837156435488 148.359525765633379 148.380189190882049 148.400827493419030 148.421440734258880 148.442028974194045 148.462592273796105 148.483130693416797 148.503644293188955 148.524133133027846 148.544597272631847 148.565036771483847 148.585451688852061 148.605842083791089 148.626208015143050 148.646549541538462 148.666866721397355 148.687159612930287 148.707428274139176 148.727672762818543 148.747893136556286 148.768089452734841 148.788261768532010 148.808410140922035 148.828534626676458 148.848635282365194 148.868712164357476 148.888765328822672 148.908794831731370 148.928800728856316 148.948783075773150 148.968741927861657 148.988677340306367 149.008589368097688 149.028478066032704 149.048343488716171 149.068185690561222 149.088004725790626 149.107800648437234 149.127573512345208 149.147323371170700 149.167050278382874 149.186754287264648 149.206435450913602 149.226093822242859 149.245729453981966 149.265342398677603 149.284932708694583 149.304500436216586 149.324045633247152 149.343568351610287 149.363068642951390 149.382546558738142 149.402002150261239 149.421435468635167 149.440846564799159 149.460235489517800 149.479602293381987 149.498947026809645 149.518269740046520 149.537570483166974 149.556849306074696 149.576106258503700 149.595341390018717 149.614554750016339 149.633746387725580 149.652916352208592 149.672064692361630 149.691191456915561 149.710296694436721 149.729380453327735 149.748442781828032 149.767483728014838 149.786503339803659 149.805501664949219 149.824478751046058 149.843434645529214 149.862369395675017 149.881283048601830 149.900175651270615 149.919047250485733 149.937897892895649 149.956727624993562 149.975536493118113 149.994324543454070 150.013091822033118 150.031838374734292 150.050564247284882 150.069269485260975 150.087954134088221 150.106618239042319 150.125261845249923 150.143884997689071 150.162487741189949 150.181070120435521 150.199632179962151 150.218173964160343 150.236695517275166 150.255196883407137 150.273678106512676 150.292139230404757 150.310580298753649 150.329001355087371 150.347402442792429 150.365783605114359 150.384144885158406 150.402486325890067 150.420807970135741 150.439109860583216 150.457392039782462 150.475654550146061 150.493897433949883 150.512120733333632 150.530324490301410 150.548508746722376 150.566673544331252 150.584818924728921 150.602944929383057 150.621051599628544 150.639138976668193 150.657207101573249 150.675256015283935 150.693285758610017 150.711296372231374 150.729287896698480 150.747260372433146 150.765213839728773 150.783148338751175 150.801063909538868 150.818960592003862 150.836838425931944 150.854697450983394 150.872537706693493 150.890359232472861 150.908162067608231 150.925946251262843 150.943711822476956 150.961458820168389 150.979187283132973 150.996897250045237 151.014588759458661 151.032261849806389 151.049916559401595 151.067552926438111 151.085170988990740 151.102770785015935 151.120352352352171 151.137915728720515 151.155460951725047 151.172988058853349 151.190497087477013 151.207988074852153 151.225461058119748 151.242916074306237 151.260353160324030 151.277772352971795 151.295173688935080 151.312557204786771 151.329922936987401 151.347270921885809 151.364601195719473 151.381913794615002 151.399208754588585 151.416486111546448 151.433745901285249 151.450988159492624 151.468212921747494 151.485420223520663 151.502610100175104 151.519782586966585 151.536937719043806 151.554075531449200 151.571196059118989 151.588299336883921 151.605385399469554 151.622454281496658 151.639506017481665 151.656540641837097 151.673558188872022 151.690558692792422 151.707542187701534 151.724508707600421 151.741458286388252 151.758390957862758 151.775306755720663 151.792205713558019 151.809087864870605 151.825953243054443 151.842801881406047 151.859633813122969 151.876449071304023 151.893247688949742 151.910029698962859 151.926795134148563 151.943544027214983 151.960276410773474 151.976992317339125 151.993691779330959 152.010374829072475 152.027041498791988 152.043691820622939 152.060325826604327 152.076943548680987 152.093545018704162 152.110130268431590 152.126699329528122 152.143252233565931 152.159789012024930 152.176309696293089 152.192814317666887 152.209302907351514 152.225775496461438 152.242232116020489 152.258672796962458 152.275097570131351 152.291506466281618 152.307899516078749 152.324276750099358 152.340638198831726 152.356983892676027 152.373313861944723 152.389628136862797 152.405926747568287 152.422209724112435 152.438477096460076 152.454728894490017 152.470965147995344 152.487185886683648 152.503391140177570 152.519580938014883 152.535755309648920 152.551914284449055 152.568057891700647 152.584186160605782 152.600299120283267 152.616396799769092 152.632479228016734 152.648546433897479 152.664598446200642 152.680635293633998 152.696657004824033 152.712663608316205 152.728655132575341 152.744631605985916 152.760593056852287 152.776539513399001 152.792471003771311 152.808387556035086 152.824289198177496 152.840175958107011 152.856047863653885 152.871904942570353 152.887747222530919 152.903574731132750 152.919387495895847 152.935185544263362 152.950968903601904 152.966737601201856 152.982491664277575 152.998231119967699 153.013955995335522 153.029666317369134 153.045362112981792 153.061043409012143 153.076710232224514 153.092362609309248 153.108000566882879 153.123624131488469 153.139233329595868 153.154828187601908 153.170408731830804 153.185974988534326 153.201526983892137 153.217064744011907 153.232588294929769 153.248097662610462 153.263592872947612 153.279073951764047 153.294540924811969 153.309993817773204 153.325432656259608 153.340857465813173 153.356268271906288 153.371665099942049 153.387047975254546 153.402416923109001 153.417771968702084 153.433113137162110 153.448440453549438 153.463753942856499 153.479053630008224 153.494339539862096 153.509611697208641 153.524870126771418 153.540114853207513 153.555345901107472 153.570563294995850 153.585767059331204 153.600957218506522 153.616133796849311 153.631296818621848 153.646446308021552 153.661582289181013 153.676704786168415 153.691813822987598 153.706909423578395 153.721991611816833 153.737060411515358 153.752115846423038 153.767157940225815 153.782186716546732 153.797202198946138 153.812204410921879 153.827193375909616 153.842169117282936 153.857131658353637 153.872081022371930 153.887017232526688 153.901940311945509 153.916850283695197 153.931747170781733 153.946630996150589 153.961501782686980 153.976359553215957 153.991204330502796 154.006036137253005 154.020854996112632 154.035660929668524 154.050453960448465 154.065234110921324 154.080001403497420 154.094755860528579 154.109497504308450 154.124226357072587 154.138942440998733 154.153645778207022 154.168336390760146 154.183014300663558 154.197679529865695 154.212332100258152 154.226972033675878 154.241599351897349 154.256214076644852 154.270816229584568 154.285405832326830 154.299982906426266 154.314547473382106 154.329099554638219 154.343639171583362 154.358166345551439 154.372681097821584 154.387183449618362 154.401673422112083 154.416151036418825 154.430616313600666 154.445069274665912 154.459509940569262 154.473938332211958 154.488354470442061 154.502758376054430 154.517150069791143 154.531529572341526 154.545896904342385 154.560252086378171 154.574595138981124 154.588926082631531 154.603244937757808 154.617551724736728 154.631846463893623 154.646129175502466 154.660399879786127 154.674658596916544 154.688905347014810 154.703140150151427 154.717363026346419 154.731573995569590 154.745773077740608 154.759960292729119 154.774135660355114 154.788299200388877 154.802450932551324 154.816590876513999 154.830719051899393 154.844835478281055 154.858940175183676 154.873033162083374 154.887114458407780 154.901184083536208 154.915242056799855 154.929288397481912 154.943323124817681 154.957346257994942 154.971357816153784 154.985357818387087 154.999346283740408 155.013323231212382 155.027288679754633 155.041242648272146 155.055185155623263 155.069116220619918 155.083035862027742 155.096944098566297 155.110840948909100 155.124726431683882 155.138600565472728 155.152463368812136 155.166314860193239 155.180155058061985 155.193983980819212 155.207801646820826 155.221608074377912 155.235403281756959 155.249187287179922 155.262960108824473 155.276721764823975 155.290472273267767 155.304211652201303 155.317939919626184 155.331657093500439 155.345363191738528 155.359058232211652 155.372742232747669 155.386415211131407 155.400077185104834 155.413728172366973 155.427368190574299 155.440997257340712 155.454615390237677 155.468222606794484 155.481818924498299 155.495404360794168 155.508978933085473 155.522542658733784 155.536095555059035 155.549637639339807 155.563168928813297 155.576689440675580 155.590199192081599 155.603698200145402 155.617186481940251 155.630664054498709 155.644130934812864 155.657587139834334 155.671032686474462 155.684467591604459 155.697891872055493 155.711305544618881 155.724708626046095 155.738101133048986 155.751483082299899 155.764854490431759 155.778215374038240 155.791565749673822 155.804905633853991 155.818235043055324 155.831553993715573 155.844862502233951 155.858160584970960 155.871448258248819 155.884725538351347 155.897992441524252 155.911248983975156 155.924495181873738 155.937731051351847 155.950956608503674 155.964171869385751 155.977376850017151 155.990571566379657 156.003756034417734 156.016930270038785 156.030094289113123 156.043248107474284 156.056391740918912 156.069525205207071 156.082648516062221 156.095761689171411 156.108864740185311 156.121957684718467 156.135040538349216 156.148113316620027 156.161176035037386 156.174228709072025 156.187271354159037 156.200303985697985 156.213326619052964 156.226339269552710 156.239341952490804 156.252334683125611 156.265317476680593 156.278290348344200 156.291253313270232 156.304206386577590 156.317149583350840 156.330082918639846 156.343006407460223 156.355920064793310 156.368823905586225 156.381717944752097 156.394602197170002 156.407476677685281 156.420341401109397 156.433196382220274 156.446041635762214 156.458877176446123 156.471703018949512 156.484519177916695 156.497325667958762 156.510122503653889 156.522909699547228 156.535687270151044 156.548455229944921 156.561213593375783 156.573962374857985 156.586701588773451 156.599431249471735 156.612151371270159 156.624861968453814 156.637563055275820 156.650254645957261 156.662936754687365 156.675609395623582 156.688272582891670 156.700926330585844 156.713570652768738 156.726205563471638 156.738831076694566 156.751447206406198 156.764053966544253 156.776651371015305 156.789239433695002 156.801818168428184 156.814387589028883 156.826947709280546 156.839498542935985 156.852040103717542 156.864572405317176 156.877095461396522 156.889609285587028 156.902113891490018 156.914609292676715 156.927095502688502 156.939572535036859 156.952040403203426 156.964499120640255 156.976948700769725 156.989389156984771 157.001820502648854 157.014242751096162 157.026655915631522 157.039060009530658 157.051455046040275 157.063841038377944 157.076217999732449 157.088585943263666 157.100944882102766 157.113294829352270 157.125635798086051 157.137967801349589 157.150290852159856 157.162604963505601 157.174910148347209 157.187206419616956 157.199493790219123 157.211772273029794 157.224041880897317 157.236302626642100 157.248554523056811 157.260797582906434 157.273031818928388 157.285257243832518 157.297473870301275 157.309681710989707 157.321880778525639 157.334071085509606 157.346252644515118 157.358425468088484 157.370589568749239 157.382744958989832 157.394891651276055 157.407029658046838 157.419158991714511 157.431279664664800 157.443391689256913 157.455495077823628 157.467589842671373 157.479675996080232 157.491753550304196 157.503822517570967 157.515882910082325 157.527934740013961 157.539978019515672 157.552012760711506 157.564038975699589 157.576056676552440 157.588065875316971 157.600066584014513 157.612058814640932 157.624042579166627 157.636017889536788 157.647984757671225 157.659943195464592 157.671893214786451 157.683834827481292 157.695768045368652 157.707692880243087 157.719609343874367 157.731517448007509 157.743417204362828 157.755308624635916 157.767191720497920 157.779066503595459 157.790932985550654 157.802791177961410 157.814641092401217 157.826482740419408 157.838316133541099 157.850141283267419 157.861958201075396 157.873766898418182 157.885567386724944 157.897359677401113 157.909143781828305 157.920919711364490 157.932687477344047 157.944447091077706 157.956198563852780 157.967941906933163 157.979677131559328 157.991404248948470 158.003123270294623 158.014834206768512 158.026537069517929 158.038231869667470 158.049918618318884 158.061597326550896 158.073268005419465 158.084930665957700 158.096585319176029 158.108231976062171 158.119870647581308 158.131501344676025 158.143124078266453 158.154738859250330 158.166345698502994 158.177944606877531 158.189535595204745 158.201118674293326 158.212693854929853 158.224261147878735 158.235820563882584 158.247372113661896 158.258915807915457 158.270451657320137 158.281979672531037 158.293499864181655 158.305012242883805 158.316516819227701 158.328013603782068 158.339502607094204 158.350983839689917 158.362457312073786 158.373923034728989 158.385381018117556 158.396831272680316 158.408273808837009 158.419708636986257 158.431135767505737 158.442555210752204 158.453966977061413 158.465371076748426 158.476767520107472 158.488156317412006 158.499537478914874 158.510911014848347 158.522276935424088 158.533635250833242 158.544985971246604 158.556329106814474 158.567664667666861 158.578992663913539 158.590313105643986 158.601626002927503 158.612931365813353 158.624229204330675 158.635519528488601 158.646802348276339 158.658077673663115 158.669345514598348 158.680605881011701 158.691858782813028 158.703104229892517 158.714342232120686 158.725572799348498 158.736795941407365 158.748011668109172 158.759219989246446 158.770420914592250 158.781614453900374 158.792800616905282 158.803979413322253 158.815150852847296 158.826314945157407 158.837471699910452 158.848621126745201 158.859763235281548 158.870898035120405 158.882025535843781 158.893145747014927 158.904258678178195 158.915364338859348 158.926462738565391 158.937553886784627 158.948637792986915 158.959714466623410 158.970783917126965 158.981846153911874 158.992901186374013 159.003949023891010 159.014989675822108 159.026023151508383 159.037049460272584 159.048068611419467 159.059080614235512 159.070085477989295 159.081083211931258 159.092073825293966 159.103057327291964 159.114033727121978 159.125003033962912 159.135965256975908 159.146920405304286 159.157868488073774 159.168809514392393 159.179743493350571 159.190670434021172 159.201590345459636 159.212503236703810 159.223409116774178 159.234307994673884 159.245199879388707 159.256084779887146 159.266962705120449 159.277833664022694 159.288697665510711 159.299554718484416 159.310404831826418 159.321248014402528 159.332084275061362 159.342913622634825 159.353736065937767 159.364551613768242 159.375360274907507 159.386162058119993 159.396956972153532 159.407745025739160 159.418526227591371 159.429300586407976 159.440068110870300 159.450828809643099 159.461582691374730 159.472329764697093 159.483070038225691 159.493803520559709 159.504530220282021 159.515250145959186 159.525963306141648 159.536669709363565 159.547369364143094 159.558062278982106 159.568748462366614 159.579427922766456 159.590100668635614 159.600766708412010 159.611426050517792 159.622078703359165 159.632724675326585 159.643363974794710 159.653996610122391 159.664622589652879 159.675241921713734 159.685854614616886 159.696460676658688 159.707060116119948 159.717652941265982 159.728239160346618 159.738818781596308 159.749391813234098 159.759958263463659 159.770518140473342 159.781071452436322 159.791618207510396 159.802158413838271 159.812692079547475 159.823219212750388 159.833739821544327 159.844253914011574 159.854761498219375 159.865262582219998 159.875757174050818 159.886245281734261 159.896726913277945 159.907202076674650 159.917670779902323 159.928133030924215 159.938588837688826 159.949038208130020 159.959481150166937 159.969917671704223 159.980347780631860 159.990771484825331 160.001188792145626 160.011599710439270 160.022004247538291 160.032402411260477 160.042794209409124 160.053179649773227 160.063558740127576 160.073931488232631 160.084297901834560 160.094657988665546 160.105011756443503 160.115359212872193 160.125700365641393 160.136035222426784 160.146363790890064 160.156686078678888 160.167002093427044 160.177311842754420 160.187615334266923 160.197912575556671 160.208203574202059 160.218488337767610 160.228766873804091 160.239039189848711 160.249305293424811 160.259565192042174 160.269818893196970 160.280066404371865 160.290307733035860 160.300542886644507 160.310771872639862 160.320994698450590 160.331211371491861 160.341421899165539 160.351626288860075 160.361824547950647 160.372016683799103 160.382202703754103 160.392382615151064 160.402556425312184 160.412724141546477 160.422885771149936 160.433041321405369 160.443190799582595 160.453334212938302 160.463471568716216 160.473602874147161 160.483728136448974 160.493847362826557 160.503960560471910 160.514067736564300 160.524168898270091 160.534264052742856 160.544353207123464 160.554436368539996 160.564513544107967 160.574584740930050 160.584649966096379 160.594709226684472 160.604762529759284 160.614809882373208 160.624851291566131 160.634886764365490 160.644916307786161 160.654939928830686 160.664957634489156 160.674969431739385 160.684975327546738 160.694975328864302 160.704969442632944 160.714957675781164 160.724940035225359 160.734916527869643 160.744887160606083 160.754851940314381 160.764810873862359 160.774763968105702 160.784711229887932 160.794652666040719 160.804588283383566 160.814518088724157 160.824442088858120 160.834360290569236 160.844272700629404 160.854179325798668 160.864080172825084 160.873975248445220 160.883864559383625 160.893748112353251 160.903625914055056 160.913497971178714 160.923364290401935 160.933224878390888 160.943079741800148 160.952928887272662 160.962772321439843 160.972610050921617 160.982442082326315 160.992268422250845 161.002089077280772 161.011904053989980 161.021713358941156 161.031516998685618 161.041314979763172 161.051107308702569 161.060893992021022 161.070675036224600 161.080450447808175 161.090220233255138 161.099984399038163 161.109742951618330 161.119495897445717 161.129243242959376 161.138984994587275 161.148721158746156 161.158451741841901 161.168176750269254 161.177896190412042 161.187610068643181 161.197318391324558 161.207021164807173 161.216718395431144 161.226410089525814 161.236096253409528 161.245776893389973 161.255452015764007 161.265121626817660 161.274785732826302 161.284444340054506 161.294097454756354 161.303745083174988 161.313387231543061 161.323023906082710 161.332655113005274 161.342280858511685 161.351901148792223 161.361515990026732 161.371125388384485 161.380729350024353 161.390327881094720 161.399920987733594 161.409508676068469 161.419090952216607 161.428667822284837 161.438239292369644 161.447805368557283 161.457366056923547 161.466921363534254 161.476471294444707 161.486015855700231 161.495555053335750 161.505088893376069 161.514617381836047 161.524140524720110 161.533658328022852 161.543170797728578 161.552677939811673 161.562179760236461 161.571676264957233 161.581167459918333 161.590653351054073 161.600133944288871 161.609609245537229 161.619079260703700 161.628543995683032 161.638003456360082 161.647457648609844 161.656906578297537 161.666350251278629 161.675788673398699 161.685221850493747 161.694649788389910 161.704072492903663 161.713489969841817 161.722902225001576 161.732309264170340 161.741711093126128 161.751107717637126 161.760499143462084 161.769885376350231 161.779266422041133 161.788642286264945 161.798012974742306 161.807378493184387 161.816738847292896 161.826094042760133 161.835444085268989 161.844788980492979 161.854128734096264 161.863463351733515 161.872792839050362 161.882117201682860 161.891436445257909 161.900750575393261 161.910059597697085 161.919363517768659 161.928662341197935 161.937956073565715 161.947244720443535 161.956528287393894 161.965806779970166 161.975080203716601 161.984348564168357 161.993611866851523 162.002870117283180 162.012123320971398 162.021371483415123 162.030614610104578 162.039852706520691 162.049085778135662 162.058313830412771 162.067536868806286 162.076754898761635 162.085967925715437 162.095175955095385 162.104378992320335 162.113577042800443 162.122770111936944 162.131958205122373 162.141141327740513 162.150319485166420 162.159492682766427 162.168660925898081 162.177824219910434 162.186982570143755 162.196135981929672 162.205284460591230 162.214428011442862 162.223566639790477 162.232700350931282 162.241829150154075 162.250953042739042 162.260072033957897 162.269186129073830 162.278295333341646 162.287399652007537 162.296499090309396 162.305593653476649 162.314683346730362 162.323768175283135 162.332848144339266 162.341923259094642 162.350993524736936 162.360058946445406 162.369119529391071 162.378175278736620 162.387226199636530 162.396272297237061 162.405313576676207 162.414350043083743 162.423381701581263 162.432408557282258 162.441430615291949 162.450447880707486 162.459460358618031 162.468468054104335 162.477470972239388 162.486469118087825 162.495462496706523 162.504451113144057 162.513434972441132 162.522414079630494 162.531388439736816 162.540358057776757 162.549322938759190 162.558283087684885 162.567238509546883 162.576189209330153 162.585135192011847 162.594076462561304 162.603013025939958 162.611944887101401 162.620872050991409 162.629794522548025 162.638712306701507 162.647625408374211 162.656533832480875 162.665437583928508 162.674336667616274 162.683231088435775 162.692120851270886 162.701005960997747 162.709886422484971 162.718762240593406 162.727633420176403 162.736499966079549 162.745361883140987 162.754219176191242 162.763071850053251 162.771919909542419 162.780763359466675 162.789602204626362 162.798436449814403 162.807266099816161 162.816091159409609 162.824911633365218 162.833727526446125 162.842538843407851 162.851345588998754 162.860147767959575 162.868945385023949 162.877738444917838 162.886526952360157 162.895310912062371 162.904090328728500 162.912865207055575 162.921635551733061 162.930401367443324 162.939162658861363 162.947919430655077 162.956671687485027 162.965419434004673 162.974162674860167 162.982901414690559 162.991635658127763 163.000365409796444 163.009090674314280 163.017811456291668 163.026527760332044 163.035239591031655 163.043946952979809 163.052649850758598 163.061348288943066 163.070042272101489 163.078731804794785 163.087416891577050 163.096097536995387 163.104773745589910 163.113445521893823 163.122112870433227 163.130775795727487 163.139434302288919 163.148088394623016 163.156738077228340 163.165383354596599 163.174024231212655 163.182660711554462 163.191292800093208 163.199920501293263 163.208543819612146 163.217162759500638 163.225777325402674 163.234387521755508 163.242993352989572 163.251594823528649 163.260191937789756 163.268784700183119 163.277373115112454 163.285957186974599 163.294536920159857 163.303112319051820 163.311683388027518 163.320250131457215 163.328812553704665 163.337370659127004 163.345924452074769 163.354473936891935 163.363019117915940 163.371559999477569 163.380096585901214 163.388628881504644 163.397156890599206 163.405680617489679 163.414200066474336 163.422715241845083 163.431226147887344 163.439732788880036 163.448235169095682 163.456733292800436 163.465227164253918 163.473716787709549 163.482202167414187 163.490683307608435 163.499160212526505 163.507632886396266 163.516101333439281 163.524565557870801 163.533025563899685 163.541481355728678 163.549932937554047 163.558380313566033 163.566823487948312 163.575262464878620 163.583697248528267 163.592127843062428 163.600554252640165 163.608976481414061 163.617394533530899 163.625808413130983 163.634218124348649 163.642623671312037 163.651025058143091 163.659422288957757 163.667815367865785 163.676204298970845 163.684589086370579 163.692969734156577 163.701346246414232 163.709718627222998 163.718086880656301 163.726451010781489 163.734811021659993 163.743166917347139 163.751518701892309 163.759866379338973 163.768209953724522 163.776549429080490 163.784884809432441 163.793216098800031 163.801543301196915 163.809866420630954 163.818185461104065 163.826500426612313 163.834811321145878 163.843118148689030 163.851420913220238 163.859719618712177 163.868014269131606 163.876304868439604 163.884591420591306 163.892873929536108 ";
                std::stringstream msName;
                for (int i=1; i<=pathloss_vector_matlabUMa.length(); i++)
                {
                    msName << "MS"<< i;
                    imtaphy::tests::StationPhyStub* ms = createStationStub(msName.str(), wns::Position(150+i, 150+i, 1.5), "MS", 1, 0.5 * lambda, 0, registry, channel);
                    imtaphy::LinkStub linkUMaNLoS(bs, ms, imtaphy::Link::UMa, imtaphy::Link::NLoS, imtaphy::Link::NLoS, imtaphy::Link::InVehicle, ms->getPosition(), wns::Ratio::from_dB(0.0), i);
                    pathloss_value = pathlossM2135->getPathloss(&linkUMaNLoS, freqMHz) - wns::Ratio::from_dB(2.0); // 2dB feeder loss
                    mnt.put(pathloss_vector_matlabUMa[i-1]-(pathloss_value.get_dB()));
                }
                CPPUNIT_ASSERT_DOUBLES_EQUAL(0.0, mnt.mean(), 0.25);
                CPPUNIT_ASSERT_DOUBLES_EQUAL(25.0, mnt.variance(), 2.0);
                mnt.reset();
    
                // RMa test
                registry->clear();
                freqMHz = 800.0;
                lambda = 3e08/(freqMHz*1e6);
                itpp::vec pathloss_vector_matlabRMa = "82.805097593090522 83.438314918584581 84.048500987631655 84.637272544917835 85.206081853939480 85.756238278675241 86.288926437713357 86.805221563999339 87.306102570976975 87.792463224225259 88.265121738952033 88.724829062231379 89.172276050520836 89.608099714696635 90.032888674306946 90.447187938241314 90.851503109237768 91.246304093595967 91.632028384366762 92.009083975545565 92.377851955942390 92.738688824072767 93.091928559319427 93.437884479523561 93.776850910900464 94.109104692583060 94.434906535064044 94.754502249237902 95.068123860558103 95.375990620960351 95.678309929605234 95.975278172126934 96.267081486891328 96.553896465752473 96.835890795913031 97.113223848730854 97.386047220648777 97.654505230843881 97.918735379686865 98.178868771657619 98.435030505972847 98.687340037840443 98.935911512950483 99.180854077548474 99.422272166198766 99.660265769137226 99.894930680925569 100.126358731955889 100.354638004204901 100.579853032506577 100.802084992494372 101.021411876258611 101.237908656670157 101.451647441236361 101.662697616280440 101.871125982164230 102.076996880214850 102.280372311958018 102.481312051211290 102.679873749544043 102.876113035569503 103.070083608497427 103.261837326340327 103.451424289135645 103.638892917519101 103.824290026955907 104.007660897915883 104.189049342254918 104.368497766046289 104.546047229087918 104.721737501292978 104.895607116159482 105.067693421497069 105.238032627578974 105.406659852874014 105.573609167503378 105.738913634556582 105.902605349391791 106.064715477037623 106.225274287804893 106.384311191211424 106.541854768313129 106.697932802531625 106.852572309061486 107.005799562933888 107.157640125811014 107.308118871578728 107.457260010801605 107.605087114100471 107.751623134509458 107.896890428864907 108.040910778276242 108.183705407726023 108.325295004842346 108.465699737886496 108.604939272993704 108.743032790704390 108.879999001820948 109.015856162622313 109.150622089467532 109.284314172817403 109.416949390702101 109.548544321660415 109.679115157175602 109.808677713631141 109.937247443808275 110.064839447946412 110.191468484386235 110.317148979813993 110.441895039125228 110.565720454924019 110.688638716675058 110.810663019522025 110.931806272788194 111.052081108172331 111.171499887652402 111.290074711110734 111.407817423690972 111.524739622899105 111.640852665458425 111.756167673929411 111.870695543103238 111.984446946178451 112.097432340730379 112.209661974480099 112.321145890872060 112.431893934467908 112.541915756162723 112.651220818232190 112.759818399215874 112.867717598643679 112.974927341611220 113.081456383209911 113.187313312817508 113.292506558253976 113.397044389807775 113.500934924137766 113.604186128054920 113.706805822188386 113.808801684539958 113.910181253931569 114.010951933348792 114.111120993184869 114.210695574388268 114.309682691517594 114.408089235706541 114.505921977543039 114.603187569864104 114.699892550470963 114.796043344765877 114.891646268313835 114.986707529332108 115.081233231109195 115.175229374356164 115.268701859492637 115.361656488869386 115.454098968929458 115.546034912310503 115.637469839889420 115.728409182771969 115.818858284228412 115.908822401577467 115.998306708019811 116.087316294423530 116.175856171061440 116.263931269303882 116.351546443266500 116.438706471415856 116.525416058133047 116.611679835237226 116.697502363470633 116.782888133945093 116.867841569552525 116.952367026339459 117.036468794847536 117.120151101420120 117.203418109476900 117.286273920756727 117.368722576530118 117.450768058781961 117.532414291365370 117.613665141128081 117.694524419011145 117.774995881121328 117.855083229778444 117.934790114537122 118.014120133184946 118.093076832716832 118.171663710286651 118.249884214136571 118.327741744505204 118.405239654514190 118.482381251035036 118.559169795535524 118.635608504907395 118.711700552274735 118.787449067784507 118.862857139379301 118.937927813552278 119.012664096086212 119.087068952775184 119.161145310131005 119.234896056073978 119.308324040608298 119.381432076482980 119.454222939838274 119.526699370838401 119.598864074290390 119.670719720249792 119.742268944613386 119.813514349699545 119.884458504815996 119.955103946815882 120.025453180642074 120.095508679860075 120.165272887179924 120.234748214967226 120.303937045743865 120.372841732677927 120.441464600064194 120.509807943794485 120.577874031818595 120.645665104595849 120.713183375537653 120.780431031441083 120.847410232913859 120.914123114790968 120.980571786542839 121.046758332675665 121.112684813123707 121.178353263633937 121.243765696143527 121.308924099149138 121.373830438070314 121.438486655604663 121.502894672077062 121.567056385781811 121.630973673318152 121.694648389919962 121.758082369778506 121.821277426359771 121.884235352715280 121.946957921787558 122.009446886709554 122.071703981098779 122.133730919345737 122.195529396897555 122.257101090535542 122.318447658648608 122.379570741500913 122.440471961495547 122.501152923432244 122.561615214761730 122.621860405834525 122.681890050145839 122.741705684575891 122.801308829625924 122.860700989650340 122.919883653084270 122.978858292667539 123.037626365664536 123.096189314080249 123.154548564872613 123.212705530161173 123.270661607431933 123.328418179739145 123.385976615902990 123.443338270704459 123.500504485076732 123.557476586293120 123.614255888151973 123.670843691158609 123.727241282703915 123.783449937240107 123.839470916453649 123.895305469434902 123.950954832845611 124.006420231083013 124.061702876441444 124.116803969271501 124.171724698136245 124.226466239965248 124.281029760205712 124.335416412971469 124.389627341189424 124.443663676743654 124.497526540617230 124.551217043031784 124.604736283584714 124.658085351384528 124.711265325183433 124.764277273508696 124.817122254791030 124.869801317491806 124.922315500227484 124.974665831892736 125.026853331781325 125.078879009705048 125.130743866111303 125.182448892198181 125.233995070028470 125.285383372641121 125.336614764161922 125.387690199911674 125.438610626513480 125.489376981997538 125.539990195905091 125.590451189390606 125.640760875322314 125.690920158381118 125.740929935158363 125.790791094252199 125.840504516361804 125.890071074381240 125.939491633491116 125.988767051249255 126.037898177680063 126.086885855362539 126.135730919516575 126.184434198089093 126.232996511837641 126.281418674413715 126.329701492444542 126.377845765613330 126.425852286739399 126.473721841855877 126.521455210287357 126.569053164725773 126.616516471305658 126.663845889677845 126.711042173082717 126.758106068422023 126.805038316329686 126.851839651241932 126.898510801466131 126.945052489248909 126.991465430842936 127.037750336573339 127.083907910902980 127.129938852496522 127.175843854284025 127.221623603523597 127.267278781862927 127.312810065400583 127.358218124745520 127.403503625076809 127.448667226201948 127.493709582614485 127.538631343550975 127.583433153047167 127.628115649993390 127.672679468189116 127.717125236397067 127.761453578396356 127.805665113034976 127.849760454281736 127.893740211277418 127.937604988385061 127.981355385240050 128.024991996799258 128.068515413389406 128.111926220755265 128.155225000106554 128.198412328165205 128.241488777210748 128.284454915126560 128.327311305444141 128.370058507387881 128.412697075918629 128.455227561777008 128.497650511526047 128.539966467593445 128.582175968312981 128.624279547965841 128.666277736821087 128.708171061175534 128.749960043393628 128.791645201946523 128.833227051450450 128.874706102704835 128.916082862730264 128.957357834805407 128.998531518503654 129.039604409729805 129.080577000755454 129.121449780254693 129.162223233338921 129.202897841591408 129.243474083101603 129.283952432498637 129.324333360984667 129.364617336367786 129.404804823094878 129.444896282282997 129.484892171751966 129.524792946055129 129.564599056510616 129.604310951232009 129.643929075158468 129.683453870084691 129.722885774690383 129.762225224569818 129.801472652260145 129.840628487270635 129.879693156110108 129.918667082315437 129.957550686478697 129.996344386274757 130.035048596487712 130.073663729038060 130.112190193008558 130.150628394670377 130.188978737509103 130.227241622249352 130.265417446880917 130.303506606682873 130.341509494248243 130.379426499508753 130.417258009758086 130.455004409676263 130.492666081352837 130.530243404310056 130.567736755525800 130.605146509456659 130.642473038059734 130.679716710815285 130.716877894748677 130.753956954451724 130.790954252104541 130.827870147496526 130.864704998047500 130.901459158828459 130.938132982581863 130.974726819742358 131.011241018456531 131.047675924602942 131.084031881811768 131.120309231484271 131.156508312811894 131.192629462795480 131.228673016263969 131.264639305892899 131.300528662223314 131.336341413679378 131.372077886586879 131.407738405190855 131.443323291673096 131.478832866169995 131.514267446789518 131.549627349628508 131.584912888789376 131.620124376397143 131.655262122615625 131.690326435664133 131.725317621833597 131.760235985502675 131.795081829153446 131.829855453387438 131.864557156940776 131.899187236700129 131.933745987717401 131.968233703225167 132.002650674651505 132.036997191634555 132.071273542037744 132.105480011963436 132.139616885768021 132.173684446075555 132.207682973792117 132.241612748119564 132.275474046569428 132.309267144976161 132.342992317511204 132.376649836695776 132.410239973414605 132.443762996928427 132.477219174887352 132.510608773343733 132.543932056764504 132.577189288043968 132.610380728516361 132.643506637967903 132.676567274649216 132.709562895287149 132.742493755097229 132.775360107794825 132.808162205607488 132.840900299286204 132.873574638117020 132.906185469932439 132.938733041122674 132.971217596646795 133.003639380043836 133.035998633443739 133.068295597578185 133.100530511791362 133.132703614050627 133.164815140956875 133.196865327755319 133.228854408345512 133.260782615291703 133.292650179833004 133.324457331893484 133.356204300091974 133.387891311752043 133.419518592911743 133.451086368333279 133.482594861512609 133.514044294688802 133.545434888853720 133.576766863761065 133.608040437935756 133.639255828683076 133.670413252097546 133.701512923072301 133.732555055307387 133.763539861319288 133.794467552449021 133.825338338871092 133.856152429602105 133.886910032509093 133.917611354318041 133.948256600622130 133.978845975890124 134.009379683474464 134.039857925619430 134.070280903469097 134.100648817075353 134.130961865405766 134.161220246351661 134.191424156735252 134.221573792318054 134.251669347808047 134.281711016867263 134.311698992119375 134.341633465157088 134.371514626549413 134.401342665849029 134.431117771599475 134.460840131342223 134.490509931623876 134.520127358003123 134.549692595057849 134.579205826391615 134.608667234641075 134.638077001482401 134.667435307638073 134.696742332883503 134.725998256053799 134.755203255050048 134.784357506846135 134.813461187494880 134.842514472134695 134.871517534995490 134.900470549405497 134.929373687796954 134.958227121712724 134.987031021811930 135.015785557876484 135.044490898816861 135.073147212677952 135.101754666645206 135.130313427050282 135.158823659376850 135.187285528266614 135.215699197524714 135.244064830125438 135.272382588218107 135.300652633132131 135.328875125382979 135.357050224677437 135.385178089919094 135.413258879213629 135.441292749874322 135.469279858427171 135.497220360616097 135.525114411408396 135.552962164999713 135.580763774819133 135.608519393534294 135.636229173056535 135.663893264545607 135.691511818414995 135.719084984336348 135.746612911244995 135.774095747344063 135.801533640109767 135.828926736295898 135.856275181938770 135.883579122361596 135.910838702179262 135.938054065303049 135.965225354945005 135.992352713622580 136.019436283162975 136.046476204707716 136.073472618717176 136.100425664974580 136.127335482590752 136.154202210008151 136.181025985005306 136.207806944700963 136.234545225558236 136.261240963389099 136.287894293358079 136.314505349986518 136.341074267156984 136.367601178116729 136.394086215482247 136.420529511242762 136.446931196764581 136.473291402794842 136.499610259465356 136.525887896296524 136.552124442201006 136.578320025488011 136.604474773866258 136.630588814448544 136.656662273754847 136.682695277716249 136.708687951678542 136.734640420406066 136.760552808084839 136.786425238326501 136.812257834171731 136.838050718093825 136.863804012001992 136.889517837245052 136.915192314614671 136.940827564348837 136.966423706135458 136.991980859115188 137.017499141885253 137.042978672502585 137.068419568487002 137.093821946824676 137.119185923971031 137.144511615854327 137.169799137878641 137.195048604926853 137.220260131364171 137.245433831040941 137.270569817295865 137.295668202958950 137.320729100354669 137.345752621304825 137.370738877131913 137.395687978661527 137.420600036225721 137.445475159665818 137.470313458335340 137.495115041102849 137.519880016354762 137.544608491998474 137.569300575464666 137.593956373710625 137.618575993222805 137.643159540019468 137.667707119653613 137.692218837215677 137.716694797336061 137.741135104187947 137.765539861490112 137.789909172509198 137.814243140062615 137.838541866521098 137.862805453811177 137.887034003417909 137.911227616387237 137.935386393328798 137.959510434418036 137.983599839399062 138.007654707586880 138.031675137870053 138.055661228712950 138.079613078158275 138.103530783829427 138.127414442932974 138.151264152260893 138.175080008193021 138.198862106699352 138.222610543342284 138.246325413279180 138.270006811264295 138.293654831651395 138.317269568395631 138.340851115056267 138.364399564798390 138.387915010395517 138.411397544231647 138.434847258303222 138.458264244221709 138.481648593215454 138.505000396131919 138.528319743439710 138.551606725230783 138.574861431222445 138.598083950759531 138.621274372816458 138.644432785999044 138.667559278546889 138.690653938335089 138.713716852876473 138.736748109323514 138.759747794470059 138.782715994753715 138.805652796257561 138.828558284712045 138.851432545497119 138.874275663643829 138.897087723836449 138.919868810414499 138.942619007374105 138.965338398370420 138.988027066719042 139.010685095398230 139.033312567050331 139.055909563983960 139.078476168175484 139.101012461271011 139.123518524588007 139.145994439117288 139.168440285524497 139.190856144152008 139.213242095020718 139.235598217831409 139.257924591966884 139.280221296493494 139.302488410162624 139.324726011412736 139.346934178370589 139.369112988853374 139.391262520369878 139.413382850122474 139.435474055008513 139.457536211622028 139.479569396255300 139.501573684900450 139.523549153250912 139.545495876703313 139.567413930358583 139.589303389023769 139.611164327213572 139.632996819151771 139.654800938772780 139.676576759723105 139.698324355362928 139.720043798767534 139.741735162728787 139.763398519756493 139.785033942080076 139.806641501649949 139.828221270138727 139.849773318942880 139.871297719184298 139.892794541711226 139.914263857100110 139.935705735656711 139.957120247417663 139.978507462151811 139.999867449361403 140.021200278283715 140.042506017892123 140.063784736897759 140.085036503750530 140.106261386640540 140.127459453499569 140.148630772002150 140.169775409566967 140.190893433358156 140.211984910286532 140.233049907010923 140.254088489939363 140.275100725230544 140.296086678794609 140.317046416294914 140.337980003149028 140.358887504529889 140.379768985367207 140.400624510348393 140.421454143920073 140.442257950289189 140.463035993423972 140.483788337055444 140.504515044678413 140.525216179552530 140.545891804703842 140.566541982925401 140.587166776778929 140.607766248595567 140.628340460477233 140.648889474297533 140.669413351703326 140.689912154115177 140.710385942728976 140.730834778516851 140.751258722228243 140.771657834390965 140.792032175312443 140.812381805080548 140.832706783564959 140.853007170417783 140.873283025075153 140.893534406757766 140.913761374472159 140.933963987011879 140.954142302958189 140.974296380681324 140.994426278341336 141.014532053889383 141.034613765068400 141.054671469414131 141.074705224256547 141.094715086720129 141.114701113725459 141.134663361989936 141.154601888028651 141.174516748155526 141.194407998484166 141.214275694928915 141.234119893205587 141.253940648832639 141.273738017132018 141.293512053229961 141.313262812058213 141.332990348354485 141.352694716663905 141.372375971339522 141.392034166543340 141.411669356247160 141.431281594233695 141.450870934097168 141.470437429244157 141.489981132894911 141.509502098083658 141.529000377659855 141.548476024288959 141.567929090453163 141.587359628452248 141.606767690404752 141.626153328248279 141.645516593740808 141.664857538461263 141.684176213810389 141.703472671011582 141.722746961111767 141.741999134982109 141.761229243318780 141.780437336643956 141.799623465306468 141.818787679482625 141.837930029176903 141.857050564222845 141.876149334284094 141.895226388854468 141.914281777259390 141.933315548656367 141.952327752035814 141.971318436221765 141.990287649872727 142.009235441482247 142.028161859379793 142.047066951731580 142.065950766541079 142.084813351649785 142.103654754738244 142.122475023326388 142.141274204774362 142.160052346283550 142.178809494896797 142.197545697499351 142.216261000819742 142.234955451430125 142.253629095747385 142.272281980033284 142.290914150395622 142.309525652788835 142.328116533014537 142.346686836722228 142.365236609410005 142.383765896425246 142.402274742965318 142.420763194078063 142.439231294662648 142.457679089470048 142.476106623103959 142.494513940021051 142.512901084532047 142.531268100801981 142.549615032851051 142.567941924555413 142.586248819647182 142.604535761715880 142.622802794208440 142.641049960430053 142.659277303544883 142.677484866576492 142.695672692408493 142.713840823785347 142.731989303312616 142.750118173457821 142.768227476551090 142.786317254785473 142.804387550217768 142.822438404769031 142.840469860225170 142.858481958237462 142.876474740323260 142.894448247866450 142.912402522118043 142.930337604196836 142.948253535089862 142.966150355652957 142.984028106611419 143.001886828560458 143.019726561965854 143.037547347164406 143.055349224364420 143.073132233646618 143.090896414964135 143.108641808143489 143.126368452884975 143.144076388763068 143.161765655227214 143.179436291602030 143.197088337088303 143.214721830762954 143.232336811579955 143.249933318370665 143.267511389844486 143.285071064589147 143.302612381071441 143.320135377637655 143.337640092513993 143.355126563807119 143.372594829504834 143.390044927476197 143.407476895472371 143.424890771126996 143.442286591956503 143.459664395360903 143.477024218624109 143.494366098914298 143.511690073284655 143.528996178673680 143.546284451905535 143.563554929690952 143.580807648627115 143.598042645198660 143.615259955777844 143.632459616624999 143.649641663889042 143.666806133608077 143.683953061709673 143.701082484011266 143.718194436220756 143.735288953936930 143.752366072649949 143.769425827741514 143.786468254485726 143.803493388049077 143.820501263491309 143.837491915765668 143.854465379719102 143.871421690093115 143.888360881523909 143.905282988542922 143.922188045577144 143.939076086949711 143.955947146880050 143.972801259484726 143.989638458777335 144.006458778669355 144.023262252970284 144.040048915388155 144.056818799529935 144.073571938901921 144.090308366910193 144.107028116860903 144.123731221960725 144.140417715317284 144.157087629939497 144.173740998737998 144.190377854525650 144.206998230017518 144.223602157831834 144.240189670489912 144.256760800416771 144.273315579941396 144.289854041297360 144.306376216622709 144.322882137960875 144.339371837260700 144.355845346377009 144.372302697070751 144.388743921009677 144.405169049768404 144.421578114828890 144.437971147581010 144.454348179322551 144.470709241259698 144.487054364507657 144.503383580090542 144.519696918942145 144.535994411905932 144.552276089735869 144.568541983096253 144.584792122562192 144.601026538620317 144.617245261668728 144.633448322017387 144.649635749888603 144.665807575417261 144.681963828651277 144.698104539551707 144.714229737993378 144.730339453764884 144.746433716569356 144.762512556024177 144.778576001661918 144.794624082930426 144.810656829193022 144.826674269728841 144.842676433733544 144.858663350319034 144.874635048514222 144.890591557265196 144.906532905435512 144.922459121806526 144.938370235077741 144.954266273867006 144.970147266711024 144.986013242065496 145.001864228305408 145.017700253725621 145.033521346540539 145.049327534885293 145.065118846815295 145.080895310306801 145.096656953257479 145.112403803486188 145.128135888733510 145.143853236662352 145.159555874857688 145.175243830827270 145.190917132001658 145.206575805734587 145.222219879303481 145.237849379909335 145.253464334677204 145.269064770656598 145.284650714821595 145.300222194071125 145.315779235229314 145.331321865045823 145.346850110195902 145.362363997280966 145.377863552828558 145.393348803292810 145.408819775054809 145.424276494422571 145.439718987631437 145.455147280844585 145.470561400153002 145.485961371575627 145.501347221060087 145.516718974482615 145.532076657648332 145.547420296291563 145.562749916076115 145.578065542595652 145.593367201373553 145.608654917863646 145.623928717450156 145.639188625447986 145.654434667103203 145.669666867592923 145.684885252025936 145.700089845442591 145.715280672815311 145.730457759048818 145.745621128980190 145.760770807379316 145.775906818948954 145.791029188325155 145.806137940077406 145.821233098708802 145.836314688656472 145.851382734291633 145.866437259919906 145.881478289781569 145.896505848051788 145.911519958840813 145.926520646194092 145.941507934092954 145.956481846454096 145.971442407130610 145.986389639911664 146.001323568522963 146.016244216626831 146.031151607822551 146.046045765646710 146.060926713573025 146.075794475012970 146.090649073315745 146.105490531768737 146.120318873597455 146.135134121965820 146.149936299976702 146.164725430671609 146.179501537031342 146.194264641975991 146.209014768365108 146.223751938998191 146.238476176614654 146.253187503893855 146.267885943455951 146.282571517861413 146.297244249611566 146.311904161148931 146.326551274857025 146.341185613060929 146.355807198027321 146.370416051964696 146.385012197023599 146.399595655296821 146.414166448819685 146.428724599569989 146.443270129468459 146.457803060378893 146.472323414108189 146.486831212406940 146.501326476969041 146.515809229432421 146.530279491379048 146.544737284334872 146.559182629770504 146.573615549100992 146.588036063686189 146.602444194830980 146.616839963785424 146.631223391744811 146.645594499850034 146.659953309187699 146.674299840790383 146.688634115636717 146.702956154651503 146.717265978706195 146.731563608618728 146.745849065154033 146.760122369023833 146.774383540887186 146.788632601350344 146.802869570967516 146.817094470240164 146.831307319617849 146.845508139498264 146.859696950227232 146.873873772099017 146.888038625356614 146.902191530191658 146.916332506744737 146.930461575105682 146.944578755313444 146.958684067356529 146.972777531173051 146.986859166650987 147.000928993628150 147.014987031892616 147.029033301182722 147.043067821187179 147.057090611545505 147.071101691847900 147.085101081635486 147.099088800400693 147.113064867587042 147.127029302589619 147.140982124755112 147.154923353381974 147.168853007720543 147.182771106973291 147.196677670295003 147.210572716792683 147.224456265526157 147.238328335507873 147.252188945703040 147.266038115030085 147.279875862360484 147.293702206519157 147.307517166284470 147.321320760388488 147.335113007517037 147.348893926309927 147.362663535361065 147.376421853218517 147.390168898385014 147.403904689317613 147.417629244428127 147.431342582083289 147.445044720604812 147.458735678269477 147.472415473309468 147.486084123912292 147.499741648221232 147.513388064335089 147.527023390308727 147.540647644152756 147.554260843834328 147.567863007276543 147.581454152359242 147.595034296918499 147.608603458747496 147.622161655596074 147.635708905171043 147.649245225136497 147.662770633113638 147.676285146681266 147.689788783375604 147.703281560690698 147.716763496078272 147.730234606948102 147.743694910668097 147.757144424564302 147.770583165921181 147.784011151981673 147.797428399947478 147.810834926978856 147.824230750195056 147.837615886674484 147.850990353454449 147.864354167531786 147.877707345862632 147.891049905362621 147.904381862907201 147.917703235331572 147.931014039430750 147.944314291960069 147.957604009634764 147.970883209130506 147.984151907083458 147.997410120090251 148.010657864708321 148.023895157455740 148.037122014811700 148.050338453216284 148.063544489070864 148.076740138738103 148.089925418542066 148.103100344768364 148.116264933664326 148.129419201438907 148.142563164263123 148.155696838269989 148.168820239554719 148.181933384174556 148.195036288149396 148.208128967461562 148.221211438055775 148.234283715839808 148.247345816684089 148.260397756422094 148.273439550850270 148.286471215728398 148.299492766779395 148.312504219689743 148.325505590109429 148.338496893652092 148.351478145895072 148.364449362379617 148.377410558610961 148.390361750058332 148.403302952155457 148.416234180299995 148.429155449854363 148.442066776145253 148.454968174464227 148.467859660067347 148.480741248175775 148.493612953975514 148.506474792617695 148.519326779218602 148.532168928859704 148.545001256588165 148.557823777416388 148.570636506322387 148.583439458250098 148.596232648108980 148.609016090774702 148.621789801088681 148.634553793858714 148.647308083858775 148.660052685828987 148.672787614476107 148.685512884473354 148.698228510460552 148.710934507044357 148.723630888798226 148.736317670262423 148.748994865944553 148.761662490319139 148.774320557827878 148.786969082880034 148.799608079852163 148.812237563088331 148.824857546900375 148.837468045567732 148.850069073337693 148.862660644425546 148.875242773014492 148.887815473255898 148.900378759269387 148.912932645142803 148.925477144932472 148.938012272663116 148.950538042328191 148.963054467889691 148.975561563278376 148.988059342394138 149.000547819105464 149.013027007250145 149.025496920635049 149.037957573036266 149.050408978199272 149.062851149838849 149.075284101639340 149.087707847254819 149.100122400308862 149.112527774394977 149.124923983076371 149.137311039886356 149.149688958328312 149.162057751875608 149.174417433971939 149.186768018031387 149.199109517438188 149.211441945547278 149.223765315684176 149.236079641144897 149.248384935196327 149.260681211076161 149.272968481993018 149.285246761126416 149.297516061627164 149.309776396617053 149.322027779189199 149.334270222408094 149.346503739309583 149.358728342901060 149.370944046161469 149.383150862041560 149.395348803463605 149.407537883321993 149.419718114482691 149.431889509784071 149.444052082036137 149.456205844021468 149.468350808494620 149.480486988182577 149.492614395784670 149.504733043972891 149.516842945391460 149.528944112657484 149.541036558360787 149.553120295063934 149.565195335302349 149.577261691584397 149.589319376391586 149.601368402178394 149.613408781372584 149.625440526375144 149.637463649560402 149.649478163276171 149.661484079843603 149.673481411557532 149.685470170686472 149.697450369472563 149.709422020131768 149.721385134853961 149.733339725802949 149.745285805116509 149.757223384906524 149.769152477259070 149.781073094234472 149.792985247867279 149.804888950166600 149.816784213115739 149.828671048672845 149.840549468770462 149.852419485315835 149.864281110190973 149.876134355252731 149.887979232332754 149.899815753237846 149.911643929749630 149.923463773624917 149.935275296595648 149.947078510369181 149.958873426627861 149.970660057029789 149.982438413208172 149.994208506771884 150.005970349305528 150.017723952369067 150.029469327498390 150.041206486205169 150.052935439976778 150.064656200276715 150.076368778544406 150.088073186195231 150.099769434620839 150.111457535189004 150.123137499243740 150.134809338105470 150.146473063070857 150.158128685413232 150.169776216382303 150.181415667204305 150.193047049082281 150.204670373195967 150.216285650701849 150.227892892733053 150.239492110400079 150.251083314790009 150.262666516967016 150.274241727972566 150.285808958825129 150.297368220520411 150.308919524031467 150.320462880308668 150.331998300279736 150.343525794850052 150.355045374902318 150.366557051297008 150.378060834872201 150.389556736443581 150.401044766804773 150.412524936727209 150.423997256960263 150.435461738231055 150.446918391245077 150.458367226685567 150.469808255214190 150.481241487470641 150.492666934072929 150.504084605617379 150.515494512678686 150.526896665810000 150.538291075543043 150.549677752388050 150.561056706833710 150.572427949347627 150.583791490376029 150.595147340343914 150.606495509655190 150.617836008692592 150.629168847817880 150.640494037371752 150.651811587674132 150.663121509023881 150.674423811699228 150.685718505957482 150.697005602035460 150.708285110149035 150.719557040493754 150.730821403244562 150.742078208555824 150.753327466561529 150.764569187375457 150.775803381090839 150.787030057780697 150.798249227498047 150.809460900275411 150.820665086125558 150.831861795040993 150.843051036994240 150.854232821937984 150.865407159804931 150.876574060508034 150.887733533940434 150.898885589975549 150.910030238466987 150.921167489249001 150.932297352136146 150.943419836923368 150.954534953386258 150.965642711280907 150.976743120344139 150.987836190293422 150.998921930826924 151.010000351623603 151.021071462343400 151.032135272626988 151.043191792095996 151.054241030353126 151.065282996982006 151.076317701547538 151.087345153595550 151.098365362653226 151.109378338228794 151.120384089812092 ";
                imtaphy::tests::StationPhyStub* bs2 = createStationStub("BS1", wns::Position(100,100,35), "BS", 1, 10.0 * lambda, 0, registry, channel);
                for (int i=1; i<=pathloss_vector_matlabRMa.length(); i++)
                {
                    msName << "MS"<< i;
                    imtaphy::tests::StationPhyStub* ms = createStationStub(msName.str(), wns::Position(150+2*i, 150+2*i, 1.5), "MS", 1, 0.5 * lambda, 0, registry, channel);
                    imtaphy::LinkStub linkRMaNLoS(bs2, ms, imtaphy::Link::RMa, imtaphy::Link::NLoS, imtaphy::Link::NLoS, imtaphy::Link::InVehicle, ms->getPosition(), wns::Ratio::from_dB(0.0), 1);
                    pathloss_value = pathlossM2135->getPathloss(&linkRMaNLoS, freqMHz) - wns::Ratio::from_dB(2.0); // 2dB feeder loss
                    mnt.put(pathloss_vector_matlabRMa[i-1]-pathloss_value.get_dB());
                }
                CPPUNIT_ASSERT_DOUBLES_EQUAL(0.0, mnt.mean(), 0.1);
                CPPUNIT_ASSERT_DOUBLES_EQUAL(25.0, mnt.variance(), 2.0);
                mnt.reset();
        
                // SMa test
                registry->clear();
                freqMHz = 2000.0;
                lambda = 3e08/(freqMHz*1e6);
                itpp::vec pathloss_vector_matlabSMa = "93.371401413445568 94.004618738939655 94.614804807986729 95.203576365272880 95.772385674294540 96.322542099030315 96.855230258068417 97.371525384354413 97.872406391332021 98.358767044580304 98.831425559307064 99.291132882586453 99.738579870875867 100.174403535051681 100.599192494661978 101.013491758596388 101.417806929592842 101.812607913951013 102.198332204721822 102.575387795900639 102.944155776297421 103.304992644427813 103.658232379674502 104.004188299878635 104.343154731255538 104.675408512938077 105.001210355419090 105.320806069592948 105.634427680913177 105.942294441315397 106.244613749960280 106.541581992482008 106.833385307246402 107.120200286107547 107.402194616268076 107.679527669085928 107.952351041003851 108.220809051198927 108.485039200041939 108.745172592012665 109.001334326327921 109.253643858195517 109.502215333305557 109.747157897903520 109.988575986553855 110.226569589492300 110.461234501280614 110.692662552310964 110.920941824559975 111.146156852861608 111.368388812849417 111.587715696613685 111.804212477025231 112.017951261591435 112.229001436635514 112.437429802519262 112.643300700569910 112.846676132313092 113.047615871566364 113.246177569899118 113.442416855924577 113.636387428852501 113.828141146695359 114.017728109490690 114.205196737874175 114.390593847310981 114.573964718270929 114.755353162609950 114.934801586401363 115.112351049442978 115.288041321648052 115.461910936514556 115.633997241852143 115.804336447934048 115.972963673229088 116.139912987858452 116.305217454911656 116.468909169746908 116.631019297392669 116.791578108159968 116.950615011566470 117.108158588668203 117.264236622886699 117.418876129416560 117.572103383288919 117.723943946166088 117.874422691933802 118.023563831156679 118.171390934455502 118.317926954864532 118.463194249219953 118.607214598631302 118.750009228081055 118.891598825197377 119.032003558241570 119.171243093348778 119.309336611059450 119.446302822176023 119.582159982977345 119.716925909822606 119.850617993172477 119.983253211057175 120.114848142015489 120.245418977530676 120.374981533986187 120.503551264163320 120.631143268301486 120.757772304741280 120.883452800169067 121.008198859480302 121.132024275279079 121.254942537030104 121.376966839877099 121.498110093143268 121.618384928527377 121.737803708007448 121.856378531465793 121.974121244046046 122.091043443254136 122.207156485813471 122.322471494284486 122.436999363458270 122.550750766533483 122.663736161085410 122.775965794835173 122.887449711227134 122.998197754822982 123.108219576517754 123.217524638587264 123.326122219570948 123.434021418998753 123.541231161966252 123.647760203564943 123.753617133172582 123.858810378609007 123.963348210162820 124.067238744492840 124.170489948409966 124.273109642543432 124.375105504894989 124.476485074286600 124.577255753703867 124.677424813539915 124.776999394743314 124.875986511872668 124.974393056061615 125.072225797898085 125.169491390219179 125.266196370826037 125.362347165120909 125.457950088668895 125.553011349687182 125.647537051464269 125.741533194711224 125.835005679847683 125.927960309224432 126.020402789284532 126.112338732665563 126.203773660244451 126.294713003127043 126.385162104583486 126.475126221932499 126.564610528374885 126.653620114778604 126.742159991416514 126.830235089658956 126.917850263621574 127.005010291770930 127.091719878488078 127.177983655592300 127.263806183825665 127.349191954300125 127.434145389907599 127.518670846694533 127.602772615202582 127.686454921775194 127.769721929831945 127.852577741111801 127.935026396885192 128.017071879137006 128.098718111720416 128.179968961483155 128.260828239366191 128.341299701476373 128.421387050133490 128.501093934892197 128.580423953539992 128.659380653071906 128.737967530641697 128.816188034491603 128.894045564860249 128.971543474869236 129.048685071390111 129.125473615890598 129.201912325262469 129.278004372629766 129.353752888139582 129.429160959734361 129.504231633907352 129.578967916441286 129.653372773130229 129.727449130486093 129.801199876429052 129.874627860963358 129.947735896838054 130.020526760193320 130.093003191193475 130.165167894645464 130.237023540604810 130.308572764968460 130.379818170054591 130.450762325171070 130.521407767170956 130.591757000997120 130.661812500215120 130.731576707534998 130.801052035322300 130.870240866098925 130.939145553032972 131.007768420419268 131.076111764149516 131.144177852173669 131.211968924950895 131.279487195892727 131.346734851796157 131.413714053268905 131.480426935145999 131.546875606897913 131.613062153030711 131.678988633478752 131.744657083989011 131.810069516498572 131.875227919504198 131.940134258425388 132.004790475959737 132.069198492432093 132.133360206136842 132.197277493673198 132.260952210274979 132.324386190133538 132.387581246714802 132.450539173070354 132.513261742142589 132.575750707064543 132.638007801453796 132.700034739700811 132.761833217252587 132.823404910890588 132.884751479003626 132.945874561855987 133.006775781850592 133.067456743787289 133.127919035116804 133.188164226189599 133.248193870500927 133.308009504930965 133.367612649980998 133.427004810005457 133.486187473439315 133.545162113022656 133.603930186019568 133.662493134435294 133.720852385227687 133.779009350516247 133.836965427786993 133.894722000094220 133.952280436258036 134.009642091059504 134.066808305431806 134.123780406648166 134.180559708507019 134.237147511513683 134.293545103058989 134.349753757595181 134.405774736808667 134.461609289789976 134.517258653200685 134.572724051438087 134.628006696796490 134.683107789626547 134.738028518491291 134.792770060320265 134.847333580560758 134.901720233326500 134.955931161544470 135.009967497098728 135.063830360972304 135.117520863386858 135.171040103939788 135.224389171739574 135.277569145538507 135.330581093863742 135.383426075146104 135.436105137846880 135.488619320582558 135.540969652247782 135.593157152136399 135.645182830060094 135.697047686466334 135.748752712553255 135.800298890383488 135.851687192996195 135.902918584516954 135.953994020266748 136.004914446868554 136.055680802352583 136.106294016260165 136.156755009745638 136.207064695677388 136.257223978736192 136.307233755513437 136.357094914607273 136.406808336716892 136.456374894736314 136.505795453846190 136.555070871604329 136.604201998035137 136.653189675717556 136.702034739871607 136.750738018444167 136.799300332192672 136.847722494768789 136.896005312799531 136.944149585968404 136.992156107094445 137.040025662210951 137.087759030642388 137.135356985080847 137.182820291660676 137.230149710032890 137.277345993437763 137.324409888777012 137.371342136684717 137.418143471597006 137.464814621821205 137.511356309603968 137.557769251198010 137.604054156928413 137.650211731258025 137.696242672851554 137.742147674639057 137.787927423878642 137.833582602218002 137.879113885755629 137.924521945100594 137.969807445431883 138.014971046556980 138.060013402969503 138.104935163906049 138.149736973402241 138.194419470348436 138.238983288544148 138.283429056752112 138.327757398751373 138.371968933390008 138.416064274636767 138.460044031632464 138.503908808740107 138.547659205595096 138.591295817154275 138.634819233744452 138.678230041110311 138.721528820461572 138.764716148520250 138.807792597565793 138.850758735481634 138.893615125799215 138.936362327742955 138.979000896273675 139.021531382132054 139.063954331881092 139.106270287948490 139.148479788668027 139.190583368320915 139.232581557176104 139.274474881530580 139.316263863748702 139.357949022301597 139.399530871805496 139.441009923059880 139.482386683085338 139.523661655160481 139.564835338858700 139.605908230084879 139.646880821110528 139.687753600609739 139.728527053693938 139.769201661946454 139.809777903456649 139.850256252853711 139.890637181339656 139.930921156722860 139.971108643449924 140.011200102638043 140.051195992107012 140.091096766410175 140.130902876865690 140.170614771587111 140.210232895513514 140.249757690439736 140.289189595045400 140.328529044924863 140.367776472615191 140.406932307625681 140.445996976465153 140.484970902670483 140.523854506833771 140.562648206629774 140.601352416842758 140.639967549393106 140.678494013363633 140.716932215025452 140.755282557864120 140.793545442604398 140.831721267235963 140.869810427037919 140.907813314603288 140.945730319863799 140.983561830113103 141.021308230031309 141.058969901707883 141.096547224665045 141.134040575880874 141.171450329811705 141.208776858414808 141.246020531170331 141.283181715103723 141.320260774806769 141.357258072459587 141.394173967851600 141.431008818402574 141.467762979183505 141.504436802936908 141.541030640097347 141.577544838811548 141.613979744957987 141.650335702166814 141.686613051839345 141.722812133166997 141.758933283150554 141.794976836618957 141.830943126248002 141.866832482578360 141.902645234034452 141.938381706941954 141.974042225545929 142.009627112028170 142.045136686525069 142.080571267144620 142.115931169983583 142.151216709144478 142.186428196752217 142.221565942970642 142.256630256019179 142.291621442188642 142.326539805857692 142.361385649508520 142.396159273742484 142.430860977295850 142.465491057055232 142.500049808072447 142.534537523580184 142.568954495006494 142.603301011989601 142.637577362392790 142.671783832318482 142.705920706123067 142.739988266430629 142.773986794147191 142.807916568474639 142.841777866924474 142.875570965331235 142.909296137866249 142.942953657050850 142.976543793769650 143.010066817283473 143.043522995242427 143.076912593698779 143.110235877119550 143.143493108399042 143.176684548871435 143.209810458322977 143.242871095004261 143.275866715642223 143.308797575452303 143.341663928149899 143.374466025962562 143.407204119641250 143.439878458472066 143.472489290287513 143.505036861477720 143.537521417001841 143.569943200398910 143.602302453798814 143.634599417933231 143.666834332146436 143.699007434405672 143.731118961311950 143.763169148110364 143.795158228700586 143.827086435646720 143.858954000188021 143.890761152248530 143.922508120447048 143.954195132107117 143.985822413266817 144.017390188688353 144.048898681867684 144.080348115043904 144.111738709208794 144.143070684116140 144.174344258290830 144.205559649038122 144.236717072452620 144.267816743427346 144.298858875662461 144.329843681674362 144.360771372804095 144.391642159226137 144.422456249957179 144.453213852864110 144.483915174673086 144.514560420977176 144.545149796245170 144.575683503829509 144.606161745974504 144.636584723824114 144.666952637430370 144.697265685760811 144.727524066706678 144.757727977090298 144.787877612673128 144.817973168163121 144.848014837222337 144.878002812474449 144.907937285512133 144.937818446904487 144.967646486204103 144.997421591954520 145.027143951697298 145.056813751978950 145.086431178358225 145.115996415412837 145.145509646746660 145.174971054996149 145.204380821837475 145.233739127993118 145.263046153238548 145.292302076408816 145.321507075405123 145.350661327201209 145.379765007849954 145.408818292489741 145.437821355350565 145.466774369760543 145.495677508152028 145.524530942067713 145.553334842166976 145.582089378231558 145.610794719171935 145.639451033033026 145.668058487000280 145.696617247405385 145.725127479731896 145.753589348621688 145.782003017879759 145.810368650480513 145.838686408573182 145.866956453487205 145.895178945738053 145.923354045032511 145.951481910274168 145.979562699568703 146.007596570229424 146.035583678782245 146.063524180971172 146.091418231763470 146.119265985354815 146.147067595174207 146.174823213889368 146.202532993411609 146.230197084900652 146.257815638770012 146.285388804691479 146.312916731600069 146.340399567699137 146.367837460464813 146.395230556650972 146.422579002293816 146.449882942716613 146.477142522534280 146.504357885658067 146.531529175300051 146.558656533977654 146.585740103518020 146.612780025062790 146.639776439072278 146.666729485329626 146.693639302945797 146.720506030363225 146.747329805360380 146.774110765056037 146.800849045913282 146.827544783744173 146.854198113713096 146.880809170341593 146.907378087512029 146.933904998471803 146.960390035837293 146.986833331597808 147.013235017119598 147.039595223149888 147.065914079820431 147.092191716651570 147.118428262556080 147.144623845843057 147.170778594221332 147.196892634803618 147.222966094109893 147.248999098071238 147.274991772033587 147.300944240761140 147.326856628439884 147.352729058681547 147.378561654526806 147.404354538448899 147.430107832357038 147.455821657600097 147.481496134969746 147.507131384703911 147.532727526490504 147.558284679470233 147.583802962240298 147.609282492857659 147.634723388842104 147.660125767179721 147.685489744326162 147.710815436209401 147.736102958233715 147.761352425281871 147.786563951719216 147.811737651396015 147.836873637650939 147.861972023313996 147.887032920709714 147.912056441659871 147.937042697486987 147.961991799016602 147.986903856580795 148.011778980020836 148.036617278690386 148.061418861457867 148.086183836709864 148.110912312353520 148.135604395819712 148.160260194065700 148.184879813577879 148.209463360374514 148.234010940008687 148.258522657570751 148.282998617691106 148.307438924543050 148.331843681845157 148.356212992864272 148.380546960417689 148.404845686876143 148.429109274166223 148.453337823772955 148.477531436742282 148.501690213683872 148.525814254773110 148.549903659754108 148.573958527941954 148.597978958225099 148.621965049067967 148.645916898513349 148.669834604184473 148.693718263288048 148.717567972615967 148.741383828548095 148.765165927054397 148.788914363697359 148.812629233634254 148.836310631619369 148.859958652006441 148.883573388750705 148.907154935411313 148.930703385153436 148.954218830750591 148.977701364586665 149.001151078658296 149.024568064576783 149.047952413570528 149.071304216486993 149.094623563794755 149.117910545585801 149.141165251577490 149.164387771114548 149.187578193171504 149.210736606354089 149.233863098901935 149.256957758690163 149.280020673231604 149.303051929678588 149.326051614825104 149.349019815108761 149.371956616612636 149.394862105067091 149.417736365852136 149.440579483998874 149.463391544191552 149.486172630769545 149.508922827729151 149.531642218725437 149.554330887074116 149.576988915753304 149.599616387405405 149.622213384339034 149.644779988530559 149.667316281626057 149.689822344943053 149.712298259472362 149.734744105879571 149.757159964507082 149.779545915375792 149.801902038186455 149.824228412321958 149.846525116848539 149.868792230517698 149.891029831767781 149.913237998725634 149.935416809208448 149.957566340724952 149.979686670477520 150.001777875363587 150.023840031977073 150.045873216610346 150.067877505255495 150.089852973605986 150.111799697058387 150.133717750713657 150.155607209378843 150.177468147568646 150.199300639506845 150.221104759127826 150.242880580078179 150.264628175718002 150.286347619122580 150.308038983083804 150.329702340111567 150.351337762435151 150.372945322005023 150.394525090493801 150.416077139298011 150.437601539539344 150.459098362066243 150.480567677455184 150.502009556011814 150.523424067772737 150.544811282506885 150.566171269716477 150.587504098638789 150.608809838247225 150.630088557252833 150.651340324105576 150.672565206995586 150.693763273854643 150.714934592357167 150.736079229921984 150.757197253713173 150.778288730641577 150.799353727365997 150.820392310294437 150.841404545585590 150.862390499149654 150.883350236649989 150.904283823504102 150.925191324884935 150.946072805722224 150.966928330703411 150.987757964275147 151.008561770644235 151.029339813779018 151.050092157410489 151.070818865033459 151.091519999907604 151.112195625058860 151.132845803280446 151.153470597134003 151.174070068950613 151.194644280832222 151.215193294652607 151.235717172058372 151.256215974470251 151.276689763084022 151.297138598871925 151.317562542583289 151.337961654746010 151.358335995667488 151.378685625435622 151.399010603919976 151.419310990772857 151.439586845430227 151.459838227112812 151.480065194827233 151.500267807366924 151.520446123313235 151.540600201036341 151.560730098696411 151.580835874244457 151.600917585423474 151.620975289769262 151.641009044611565 151.661018907075203 151.681004934080590 151.700967182345011 151.720905708383668 151.740820568510571 151.760711818839184 151.780579515283989 151.800423713560633 151.820244469187713 151.840041837487092 151.859815873585006 151.879566632413258 151.899294168709616 151.918998537018979 151.938679791694568 151.958337986898357 151.977973176602291 151.997585414588769 152.017174754452213 152.036741249599203 152.056284953249929 152.075805918438704 152.095304198014929 152.114779844644062 152.134232910808180 152.153663448807322 152.173071510759769 152.192457148603324 152.211820414095826 152.231161358816280 152.250480034165435 152.269776491366684 152.289050781466841 152.308302955337126 152.327533063673826 152.346741156999002 152.365927285661542 152.385091499837671 152.404233849531920 152.423354384577948 152.442453154639139 152.461530209209513 152.480585597614436 152.499619369011413 152.518631572390859 152.537622256576839 152.556591470227801 152.575539261837321 152.594465679734867 152.613370772086654 152.632254586896124 152.651117172004859 152.669958575093318 152.688778843681405 152.707578025129436 152.726356166638624 152.745113315251842 152.763849517854396 152.782564821174816 152.801259271785227 152.819932916102431 152.838585800388330 152.857217970750668 152.875829473143909 152.894420353369611 152.912990657077273 152.931540429765050 152.950069716780320 152.968578563320392 152.987067014433109 153.005535115017665 153.023982909825122 153.042410443459033 153.060817760376096 153.079204904887121 153.097571921157083 153.115918853206153 153.134245744910402 153.152552640002256 153.170839582070926 153.189106614563457 153.207353780785127 153.225581123899929 153.243788686931509 153.261976512763567 153.280144644140393 153.298293123667662 153.316421993812895 153.334531296906135 153.352621075140547 153.370691370572843 153.388742225124076 153.406773680580244 153.424785778592536 153.442778560678335 153.460752068221495 153.478706342473117 153.496641424551939 153.514557355444936 153.532454176008002 153.550331926966464 153.568190648915504 153.586030382320928 153.603851167519451 153.621653044719466 153.639436054001663 153.657200235319209 153.674945628498563 153.692672273240021 153.710380209118114 153.728069475582231 153.745740111957161 153.763392157443377 153.781025651118000 153.798640631935058 153.816237138725739 153.833815210199532 153.851374884944192 153.868916201426515 153.886439197992672 153.903943912869039 153.921430384162193 153.938898649859908 153.956348747831271 153.973780715827473 153.991194591482042 154.008590412311577 154.025968215715949 154.043328038979183 154.060669919269372 154.077993893639700 154.095299999028725 154.112588272260609 154.129858750045969 154.147111468982189 154.164346465553734 154.181563776132890 154.198763436980073 154.215945484244116 154.233109953963151 154.250256882064718 154.267386304366312 154.284498256575802 154.301592774292004 154.318669893005023 154.335729648096617 154.352772074840800 154.369797208404151 154.386805083846411 154.403795736120742 154.420769200074204 154.437725510448189 154.454664701878983 154.471586808897996 154.488491865932190 154.505379907304786 154.522250967235124 154.539105079839800 154.555942279132410 154.572762599024401 154.589566073325358 154.606352735743201 154.623122619884981 154.639875759256995 154.656612187265296 154.673331937215977 154.690035042315799 154.706721535672330 154.723391450294542 154.740044819093072 154.756681674880696 154.773302050372592 154.789905978186880 154.806493490844957 154.823064620771845 154.839619400296499 154.856157861652406 154.872680036977783 154.889185958315920 154.905675657615774 154.922149166732055 154.938606517425825 154.955047741364695 154.971472870123421 154.987881935183964 155.004274967936084 155.020651999677597 155.037013061614772 155.053358184862702 155.069687400445588 155.086000739297219 155.102298232261035 155.118579910090915 155.134845803451242 155.151095942917266 155.167330358975391 155.183549082023774 155.199752142372404 155.215939570243677 155.232111395772307 155.248267649006351 155.264408359906810 155.280533558348424 155.296643274120015 155.312737536924374 155.328816376379223 155.344879822016992 155.360927903285472 155.376960649548039 155.392978090083886 155.408980254088590 155.424967170674108 155.440938868869267 155.456895377620270 155.472836725790586 155.488762942161600 155.504674055432758 155.520570094222109 155.536451087066069 155.552317062420542 155.568168048660539 155.584004074080610 155.599825166895613 155.615631355240339 155.631422667170341 155.647199130661875 155.662960773612554 155.678707623841206 155.694439709088556 155.710157057017398 155.725859695212733 155.741547651182344 155.757220952356704 155.772879626089662 155.788523699658526 155.804153200264352 155.819768155032278 155.835368591011701 155.850954535176641 155.866526014426142 155.882083055584388 155.897625685400840 155.913153930550976 155.928667817636011 155.944167373183575 155.959652623647884 155.975123595409883 155.990580314777645 156.006022807986511 156.021451101199716 156.036865220508048 156.052265191930701 156.067651041415161 156.083022794837660 156.098380478003406 156.113724116646608 156.129053736431217 156.144369362950755 156.159671021728627 156.174958738218692 156.190232537805230 156.205492445803031 156.220738487458249 156.235970687948054 156.251189072381010 156.266393665797665 156.281584493170385 156.296761579403920 156.311924949335264 156.327074627734362 156.342210639304000 156.357333008680229 156.372441760432423 156.387536919063848 156.402618509011546 156.417686554646650 156.432741080274980 156.447782110136615 156.462809668406891 156.477823779195859 156.492824466549166 156.507811754447943 156.522785666809170 156.537746227485684 156.552693460266710 156.567627388878009 156.582548036981876 156.597455428177682 156.612349586001784 156.627230533928071 156.642098295368015 156.656952893670791 156.671794352123783 156.686622693952472 156.701437942320865 156.716240120331747 156.731029251026683 156.745805357386388 156.760568462331037 156.775318588720182 156.790055759353265 156.804779996969643 156.819491324248929 156.834189763811025 156.848875338216430 156.863548069966669 156.878207981503976 156.892855095212099 156.907489433415947 156.922111018382395 156.936719872319713 156.951316017378673 156.965899475651895 156.980470269174759 156.995028419925006 157.009573949823505 157.024106880733967 157.038627234463263 157.053135032761986 157.067630297324115 157.082113049787552 157.096583311734094 157.111041104689946 157.125486450125550 157.139919369456038 157.154339884041264 157.168748015186111 157.183143784140498 157.197527212099857 157.211898320205108 157.226257129542773 157.240603661145457 157.254937935991734 157.269259975006577 157.283569799061240 157.297867428973774 157.312152885509107 157.326426189378878 157.340687361242203 157.354936421705474 157.369173391322590 157.383398290595210 157.397611139972923 157.411811959853310 157.426000770582306 157.440177592454063 157.454342445711632 157.468495350546675 157.482636327099812 157.496765395460727 157.510882575668518 157.524987887711603 157.539081351528097 157.553162987006033 157.567232813983225 157.581290852247690 157.595337121537739 157.609371641542253 157.623394431900579 157.637405512202946 157.651404901990560 157.665392620755767 157.679368687942116 157.693333122944665 157.707285945110186 157.721227173737020 157.735156828075588 157.749074927328337 157.762981490650020 157.776876537147757 157.790760085881232 157.804632155862919 157.818492766058114 157.832341935385102 157.846179682715501 157.860006026874203 157.873820986639544 157.887624580743534 157.901416827872112 157.915197746664973 157.928967355716111 157.942725673573563 157.956472718740059 157.970208509672659 157.983933064783173 157.997646402438363 158.011348540959887 158.025039498624523 158.038719293664514 158.052387944267394 158.066045468576277 158.079691884690135 158.093327210663745 158.106951464507830 158.120564664189402 158.134166827631617 158.147757972714260 158.161338117273573 158.174907279102626 158.188465475951148 158.202012725526117 158.215549045491571 158.229074453468712 158.242588967036284 158.256092603730679 158.269585381045744 158.283067316433346 158.296538427303204 158.309998731023171 158.323448244919348 158.336886986276227 158.350314972336747 158.363732220302524 158.377138747333902 158.390534570550130 158.403919707029559 158.417294173809495 158.430657987886860 158.444011166217706 158.457353725717667 158.470685683262303 158.484007055686646 158.497317859785881 158.510618112315143 158.523907829989810 158.537187029485551 158.550455727438504 158.563713940445325 158.576961685063395 158.590198977810815 158.603425835166775 158.616642273571358 158.629848309425910 158.643043959093177 158.656229238897140 158.669404165123410 158.682568754019371 158.695723021793953 158.708866984618197 158.722000658625035 158.735124059909765 158.748237204529630 158.761340108504470 158.774432787816579 158.787515258410849 158.800587536194826 158.813649637039163 158.826701576777111 158.839743371205316 158.852775036083415 158.865796587134440 158.878808040044817 158.891809410464532 158.904800714007138 158.917781966250146 158.930753182734691 158.943714378965979 158.956665570413463 158.969606772510559 158.982538000655097 158.995459270209409 159.008370596500328 159.021271994819273 159.034163480422421 159.047045068530849 159.059916774330617 159.072778612972741 159.085630599573619 159.098472749214807 159.111305076943239 159.124127597771434 159.136940326677461 159.149743278605115 159.162536468464026 159.175319911129691 159.188093621443727 159.200857614213788 159.213611904213820 159.226356506184061 159.239091434831153 159.251816704828400 159.264532330815598 159.277238327399431 159.289934709153272 159.302621490617526 159.315298686299627 159.327966310674185 159.340624378182952 159.353272903235109 159.365911900207209 159.378541383443405 159.391161367255449 159.403771865922749 159.416372893692767 159.428964464780591 159.441546593369537 159.454119293610916 159.466682579624432 159.479236465497848 159.491780965287546 159.504316093018190 159.516841862683236 159.529358288244737 159.541865383633450 159.554363162749155 159.566851639460509 159.579330827605190 159.591800740990124 159.604261393391312 159.616712798554346 159.629154970193895 159.641587921994415 159.654011667609893 159.666426220663908 159.678831594750022 159.691227803431445 159.703614860241430 159.715992778683358 159.728361572230682 159.740721254327070 159.753071838386404 159.765413337793262 159.777745765902353 159.790069136039222 159.802383461500000 159.814688755551401 159.826985031431207 159.839272302348036 159.851550581481490 159.863819881982209 159.876080216972099 159.888331599544244 159.900574042763139 159.912807559664657 159.925032163256105 159.937247866516543 159.949454682396635 159.961652623818708 159.973841703677010 159.986021934837765 159.998193330139060 160.010355902391211 160.022509664376543 160.034654628849694 160.046790808537651 160.058918216139773 160.071036864327937 160.083146765746505 160.095247933012558 160.107340378715861 160.119424115418980 160.131499155657423 160.143565511939471 160.155623196746660 160.167672222533440 160.179712601727658 160.191744346730189 160.203767469915476 160.215781983631160 160.227787900198621 160.239785231912578 160.251773991041517 160.263754189827580 160.275725840486757 160.287688955209035 160.299643546157995 160.311589625471527 160.323527205261541 160.335456297614144 160.347376914589518 160.359289068222324 160.371192770521645 160.383088033470870 160.394974869027919 160.406853289125536 160.418723305670881 160.430584930546019 160.442438175607776 160.454283052687828 160.466119573592891 160.477947750104647 160.489767593979934 160.501579116950722 160.513382330724198 160.525177246982992 160.536963877384835 160.548742233563217 160.560512327126958 160.572274169660602 160.584027772724141 160.595773147853436 160.607510306560243 160.619239260331852 160.630960020631790 160.642672598899480 160.654377006550305 160.666073254975913 160.677761355544021 160.689441319598814 160.701113158460544 160.712776883425988 160.724432505768334 160.736080036737349 160.747719487559323 160.759350869437355 160.770974193551069 160.782589471056895 160.794196713088127 160.805795930755124 160.817387135145054 160.828970337322090 160.840545548327611 160.852112779180203 160.863672040875429 160.875223344386541 160.886766700663713 160.898302120634810 160.909829615205098 160.921349195257392 160.932860871652053 160.944364655227275 160.955860556798655 160.967348587159847 160.978828757082283 160.990301077315280 161.001765558586129 161.013222211600123 161.024671047040641 161.036112075569264 161.047545307825715 161.058970754427975 161.070388425972396 161.081798333033760 161.093200486165017 161.104594895898060 161.115981572743067 161.127360527188728 161.138731769702702 161.150095310731103 161.161451160698959 161.172799330010292 161.184139829047638 161.195472668172926 161.206797857726826 161.218115408029178 161.229425329378898 161.240727632054245 161.252022326312556 161.263309422390506 161.274588930504081 161.285860860848800 161.297125223599608 161.308382028910842 161.319631286916604 161.330873007730474 161.342107201445913 161.353333878135771 161.364553047853065 161.375764720630514 161.386968906480632 161.398165615396067 161.409354857349314 161.420536642293058 161.431710980160005 161.442877880863080 161.454037354295508 161.465189410330595 161.476334058822061 161.487471309604075 161.498601172491220 161.509723657278471 161.520838773741332 161.531946531635981 161.543046940699185 161.554140010648410 161.565225751181970 161.576304171978649 161.587375282698474 161.598439092982062 161.609495612451070 161.620544850708200 161.631586817337080 161.642621521902612 161.653648973950624 161.664669183008272 161.675682158583868 161.686687910167137 ";
                imtaphy::tests::StationPhyStub* bs3 = createStationStub("BS1", wns::Position(100,100,35), "BS", 1, 10.0 * lambda, 0, registry, channel);
                for (int i=1; i<=pathloss_vector_matlabSMa.length(); i++)
                {
                    msName << "MS"<< i;
                    imtaphy::tests::StationPhyStub* ms = createStationStub(msName.str(), wns::Position(150+2*i, 150+2*i, 1.5), "MS", 1, 0.5 * lambda, 0, registry, channel);
                    imtaphy::LinkStub linkSMaNLoS(bs3, ms, imtaphy::Link::SMa, imtaphy::Link::NLoS, imtaphy::Link::NLoS, imtaphy::Link::InVehicle, ms->getPosition(), wns::Ratio::from_dB(0.0), 1);
                    pathloss_value = pathlossM2135->getPathloss(&linkSMaNLoS, freqMHz) - wns::Ratio::from_dB(2.0); // 2dB feeder loss
                    mnt.put(pathloss_vector_matlabSMa[i-1]-pathloss_value.get_dB());
                }
                CPPUNIT_ASSERT_DOUBLES_EQUAL(0.0, mnt.mean(), 0.1);
                CPPUNIT_ASSERT_DOUBLES_EQUAL(25.0, mnt.variance(), 2.0);
                mnt.reset();
        
            }

            void 
            PathlossTest::testo2vUEPositionDependence()
            {
                imtaphy::Spectrum* spectrum = new imtaphy::Spectrum(2E09, 180000.0, 100, 0);
                channel->setSpectrum(spectrum);
                double lambda = spectrum->getSystemCenterFrequencyWavelenghtMeters(imtaphy::Downlink);
                wns::node::Registry* registry = new wns::node::Registry();

                std::list<imtaphy::tests::StationPhyStub*> baseStations;
                std::string bsName;
                bsName.append("BS");
                int numBS = 20;
                for (int bs = 0; bs<numBS; bs++)
                {
                    std::stringstream strm;
                    strm << bs;
                    bsName.append(strm.str());
                    baseStations.push_back(createStationStub(bsName, wns::Position(150+(20*bs),150+(10*bs),25), "BS", 1, 100.0 * lambda, 0, registry, channel));
                }
                imtaphy::tests::StationPhyStub *ms = createStationStub("MS1", wns::Position(100,100,1.5), "MS", 1, 0.5 * lambda, 3.0, registry, channel);

                itpp::vec pathloss_vector_matlabUMa = "100.854981614576843 105.358689358616658 108.964885838248762 111.959457563313293 114.515087301131175 116.741904224799100 118.713822085502144 120.482628042936412 122.085921438298300 123.551820610668670 124.901882345175011 126.152984887034734 127.318584165561788 128.409576741981283 129.434907910672678 130.402009911353446 131.317124018308988 132.185541474008062 133.011786568846929 133.799757737577266 "; // without o2v shadowing
                wns::Ratio pathloss_value;
                double o2v_Component_old = 0.0, o2v_Component_new = 0.0;
                Link::Scenario scen = Link::UMa;
                Link::UserLocation location = Link::InVehicle;
                Link::Propagation propagation = Link::NLoS;
                unsigned int i = 0;
                for (std::list<imtaphy::tests::StationPhyStub*>::const_iterator bsIter=baseStations.begin(); bsIter!=baseStations.end() ; bsIter++, i++)
                {
                    LinkStub* link = new LinkStub(*bsIter, ms, scen, propagation, propagation, location, ms->getPosition(),
                                                wns::Ratio::from_dB(0.0), i);
                    pathloss_value = pathlossM2135->getPathloss(link, 2000.0);
                    if(i==0)
                    {
                        o2v_Component_old = pathloss_value.get_dB() - pathloss_vector_matlabUMa[i];
                        break;
                    }
                    o2v_Component_new = pathloss_value.get_dB() - pathloss_vector_matlabUMa[i];
                    CPPUNIT_ASSERT_DOUBLES_EQUAL(o2v_Component_new, o2v_Component_old, 0.01);
                    o2v_Component_old = o2v_Component_new;
                }
            }

            void 
            PathlossTest::testO2IforSMa()
            {
                imtaphy::Spectrum* spectrum = new imtaphy::Spectrum(2E09, 180000.0, 100, 0);
                channel->setSpectrum(spectrum);
                double lambda = spectrum->getSystemCenterFrequencyWavelenghtMeters(imtaphy::Downlink);
                wns::node::Registry* registry = new wns::node::Registry();

                std::list<imtaphy::tests::StationPhyStub*> mobileStations;
                std::string msName;
                msName.append("MS");
                int numMS = 4;
                for (int ms = 0; ms<numMS; ms++)
                {
                    std::stringstream strm;
                    strm << ms;
                    msName.append(strm.str());
                    mobileStations.push_back(createStationStub(msName, wns::Position(150+(20*ms),150+(10*ms),1.5), "MS", 1, 0.5 * lambda, 3.0, registry, channel));
                }
                imtaphy::tests::StationPhyStub *bs = createStationStub("BS1", wns::Position(100,100,35), "BS", 1, 100.0 * lambda, 0.0, registry, channel);

        
                int i = 0;
                Link::Scenario scen = Link::SMa;
                Link::UserLocation location = Link::Indoor;
                Link::Propagation propagation = Link::NLoS;
                itpp::vec pathloss_vector_matlabSMaO2I = "103.713345789281988 108.164857208603777 111.729259190647355 114.689124925217783 "; // matlab already adds 20dB for O2I case
        
                wns::Ratio pathloss_value;
                i=0;
                for (std::list<imtaphy::tests::StationPhyStub*>::const_iterator msIter=mobileStations.begin(); msIter!=mobileStations.end() ; msIter++)
                {
                    LinkStub* link = new LinkStub(bs, *msIter, scen, propagation, propagation, location, (*msIter)->getPosition(),
                                                wns::Ratio::from_dB(0.0), i);
                    pathloss_value = pathlossM2135->getPathloss(link, 2000.0) - wns::Ratio::from_dB(2.0);
                    CPPUNIT_ASSERT_DOUBLES_EQUAL(pathloss_vector_matlabSMaO2I[i++], pathloss_value.get_dB(), 0.01);
                    //linkManager->addLink(link, true);
                }  
            }
            void
            PathlossTest::testO2IUMiDistanceDependence()
            {
                double pathloss_TW = 20.0; // pathloss ThroughWall == 20dB for hexagonal layout
                wns::node::Registry* registry = new wns::node::Registry();
                freqMHz = 2500.0;
                double lambda = 3e08/(freqMHz*1e6);
                imtaphy::tests::StationPhyStub* bs = createStationStub("BS1", wns::Position(100,100,10), "BS", 1, 10.0 * lambda, 0, registry, channel);
                wns::Ratio pathloss_value;
                wns::evaluation::statistics::Moments mntNLoS;
                wns::evaluation::statistics::Moments mntLoS;
                itpp::vec pathloss_vector_matlabUMiWithoutO2INLoS = "103.165201171345302 105.151277512330239 106.929576251028095 108.537300740303436 110.003037702868653 111.349041441668277 112.592884956584214 113.748639384604857 114.827720065107741 115.839499899435310 116.791759797668703 117.691023996280109 118.542813026947130 119.351837013950444 120.122145165670915 120.857242697920555 121.560183249808418 122.233642646050697 122.879978308091495 123.501277512330290 124.099396898835508 124.675995055104153 125.232559573397680 125.770429663393742 126.290815164029453 126.794812618168180 127.283418935947878 127.757543066484800 128.218016015137266 128.665599479001287 129.100993322465285 129.524842074322521 129.937740595750284 130.340239042619288 130.732847224725816 131.116038447594747 131.490252908672602 131.855900708390493 132.213364527232727 132.563002012213389 132.905147909736002 133.240115976446589 133.568200695196595 133.889678819450324 134.204810766283060 134.513841875411345 134.817003549402273 135.114514288249296 135.406580629828738 135.693398006314339 135.975151525392846 136.252016684057480 136.524160021835257 136.791739719504733 137.054906148667953 137.313802376932841 137.568564632936727 137.819322734977959 138.066200486616452 138.309316042249350 138.548782245352839 138.784706941803535 139.017193270450036 139.246339932885860 139.472241444184078 139.694988366181803 139.914667524751593 140.131362212358994 140.345152377085498 140.556114799187526 140.764323256163095 140.969848677213008 141.172759287902153 141.373120745758058 141.570996267478677 141.766446748364643 141.959530874539155 142.150305228471410 142.338824388277743 142.525141021234219 142.709305971902467 142.891368345234639 143.071375584998435 143.249373547834125 143.425406573231584 143.599517549695150 143.771747977341676 143.942138027160752 144.110726597147476 144.277551365504905 144.442648841096116 144.606054411316308 144.767802387540570 144.927926048293642 145.086457680276652 145.243428617378072 145.398869277785820 145.552809199310389 145.705277073022103 145.856300775297143 ";
                itpp::vec pathloss_vector_matlabUMiWithoutO2ILoS = "77.991844882138054 79.182408356297969 80.248418499386560 81.212177048815960 82.090820459617987 82.897689185873872 83.643317450946114 84.796854942828645 85.972964676346777 87.075721988965370 88.113607436631213 89.093731903782611 90.022112318678495 90.903882331761139 91.743455249167653 92.544651469603210 93.310799210080461 94.044814900807722 94.749267938454409 95.426433283673759 96.078334522371591 96.706779379340105 97.313389208542873 97.899623639056273 98.466801296424904 99.016117322734118 99.548658268543093 100.065414814087404 100.567292687278098 101.055122075685730 101.529665774284126 101.991626266771590 102.441651903205084 102.880342308511885 103.308253133696184 103.725900243090123 104.133763415926978 104.532289628153521 104.921895970215928 105.302972248124036 105.675883308094171 106.040971119222888 106.398556643746005 106.748941520316862 107.092409582259904 107.429228229811145 107.759649672853044 108.083912058517370 108.402240496206133 108.714847991013301 109.021936295186094 109.323696686101243 109.620310678229558 109.911950675689525 110.198780571235233 110.480956296864505 110.758626330656284 111.031932163943736 111.301008732487006 111.565984814920711 111.826983401409564 112.084122035143253 112.337513129035926 112.587264259756168 112.833478441007600 113.076254377789880 113.315686703206524 113.551866199236400 113.784880002753084 114.014811797959581 114.241741996298060 114.465747904799315 114.686903883752109 114.905281494494247 115.120949638058960 115.333974685346092 115.544420599432726 115.752349050585110 115.957819524488386 116.160889424168545 116.361614166041278 116.560047270490514 116.756240447344794 116.950243676593459 117.142105284656139 117.331872016496490 117.519589103849640 117.705300329810498 117.889048090014015 118.070873450621605 118.250816203309554 118.428914917446008 118.605206989625060 118.779728690718329 118.952515210590803 119.123600700619619 119.293018314142998 119.460800244960055 119.626977763991874 119.791581254209831 ";

                std::stringstream msName;
                for (int i=1; i<=pathloss_vector_matlabUMiWithoutO2INLoS.length(); i++)
                {
                    msName << "MS"<< i;
                    imtaphy::tests::StationPhyStub* ms = createStationStub(msName.str(), wns::Position(150+(10*i), 150+(5*i), 1.5), "MS", 1, 0.5 * lambda, 0, registry, channel);
                    imtaphy::LinkStub linkUMiNLoS(bs, ms, imtaphy::Link::UMi, imtaphy::Link::UMiO2I, imtaphy::Link::NLoS, imtaphy::Link::Indoor, ms->getPosition(), wns::Ratio::from_dB(0.0), i);
                    imtaphy::LinkStub linkUMiLoS(bs, ms, imtaphy::Link::UMi, imtaphy::Link::UMiO2I, imtaphy::Link::LoS, imtaphy::Link::Indoor, ms->getPosition(), wns::Ratio::from_dB(0.0), i);
                    pathloss_value = pathlossM2135->getPathloss(&linkUMiNLoS, freqMHz) - wns::Ratio::from_dB(2.0);  // 2dB feeder loss
                    mntNLoS.put( (pathloss_value.get_dB()) - (pathloss_vector_matlabUMiWithoutO2INLoS[i-1] + pathloss_TW) );
                    pathloss_value = pathlossM2135->getPathloss(&linkUMiLoS, freqMHz) - wns::Ratio::from_dB(2.0);  // 2dB feeder loss
                    mntLoS.put( (pathloss_value.get_dB()) - (pathloss_vector_matlabUMiWithoutO2ILoS[i-1] + pathloss_TW) );
                }
                // the indoor distance is 0..25 with 0.5 dB loss per meter, so we expect to see 25 *0.5 / 2 on average
                CPPUNIT_ASSERT_DOUBLES_EQUAL(25.0/4.0, mntNLoS.mean(), 1.0);
                CPPUNIT_ASSERT_DOUBLES_EQUAL(25.0/4.0, mntLoS.mean(), 1.0);
                mntNLoS.reset();
                
                
            }


        }}}
